---
phase: 11-council-fixes
plan: 07
type: execute
wave: 4
depends_on: [11-01, 11-02]
files_modified:
  - Plugins/GSD_Crowds/Source/GSD_Crowds/Public/DataAssets/GSDCrowdConfig.h
  - Plugins/GSD_Crowds/Source/GSD_Crowds/Private/DataAssets/GSDCrowdConfig.cpp
  - Plugins/GSD_Vehicles/Source/GSD_Vehicles/Public/DataAssets/GSDVehicleConfig.h
  - Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Processors/GSDZombieBehaviorProcessor.cpp
  - Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Processors/GSDCrowdLODProcessor.cpp
autonomous: true
must_haves:
  truths:
    - "All hardcoded values replaced with DataAsset configuration"
    - "Detection radius is configurable via UGSDCrowdConfig"
    - "LOD thresholds are configurable via UGSDCrowdConfig"
    - "Behavior values are configurable via UGSDCrowdConfig"
  artifacts:
    - path: "Plugins/GSD_Crowds/Source/GSD_Crowds/Public/DataAssets/GSDCrowdConfig.h"
      provides: "Configurable crowd parameters"
      contains: "DetectionRadius, LODDistances, MaxEntityCount"
    - path: "Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Processors/GSDZombieBehaviorProcessor.cpp"
      provides: "Config-driven behavior"
      pattern: "Config->DetectionRadius|Config->MaxSpeed"
  key_links:
    - from: "Processors"
      to: "UGSDCrowdConfig"
      via: "Config lookup"
      pattern: "GetConfig\\(\\)->|Config->"
---

<objective>
Replace all hardcoded values in processors with DataAsset configuration.

Purpose: Make the platform data-driven instead of hardcoded. Council review identified multiple hardcoded values (detection radius, LOD thresholds, behavior values) that should be configurable via DataAssets.

Output: UGSDCrowdConfig and UGSDVehicleConfig with all configurable parameters, processors updated to use config lookups.

Council Issues: #13, #14, #15, #16 - Hardcoded detection radius, LOD thresholds, behavior values, timing values (Architecture Rick, P1)
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-council-fixes/11-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UGSDCrowdConfig DataAsset</name>
  <files>
    Plugins/GSD_Crowds/Source/GSD_Crowds/Public/DataAssets/GSDCrowdConfig.h
    Plugins/GSD_Crowds/Source/GSD_Crowds/Private/DataAssets/GSDCrowdConfig.cpp
  </files>
  <action>
Create UGSDCrowdConfig DataAsset to hold all configurable crowd parameters.

**GSDCrowdConfig.h:**
```cpp
#pragma once

#include "CoreMinimal.h"
#include "Engine/DataAsset.h"
#include "GSDCrowdConfig.generated.h"

/**
 * Configurable parameters for crowd systems.
 * Replaces hardcoded values throughout crowd processors.
 */
UCLASS(BlueprintType)
class GSD_CROWDS_API UGSDCrowdConfig : public UDataAsset
{
    GENERATED_BODY()

public:
    // === Detection and Perception ===

    /** Detection radius for entities (replaces hardcoded 5000.0f) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Detection")
    float DetectionRadius = 5000.0f;

    /** Vision angle for entity perception */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Detection")
    float VisionAngle = 90.0f;

    /** Hearing range for sound detection */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Detection")
    float HearingRange = 1500.0f;

    // === LOD Distances ===

    /** Distance for LOD 0 (full detail) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "LOD")
    float LOD0Distance = 500.0f;

    /** Distance for LOD 1 (actor representation) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "LOD")
    float LOD1Distance = 2000.0f;

    /** Distance for LOD 2 (ISM representation) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "LOD")
    float LOD2Distance = 4000.0f;

    /** Distance for LOD 3 (culled) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "LOD")
    float LOD3CullDistance = 5000.0f;

    // === Entity Limits ===

    /** Maximum number of entities to spawn */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Limits")
    int32 MaxEntityCount = 200;

    /** Entities per batch during spawning */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Limits")
    int32 EntitiesPerBatch = 10;

    /** Frame budget for entity processing (ms) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Limits")
    float ProcessingFrameBudget = 2.0f;

    // === Behavior Parameters ===

    /** Base movement speed (replaces hardcoded values) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Behavior")
    float BaseMoveSpeed = 150.0f;

    /** Speed variation percentage (20% = 0.2f) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Behavior")
    float SpeedVariationPercent = 0.2f;

    /** Maximum speed multiplier */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Behavior")
    float MaxSpeedMultiplier = 1.5f;

    /** Wandering radius for random movement */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Behavior")
    float WanderingRadius = 500.0f;

    // === Navigation ===

    /** Lane search radius for ZoneGraph */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Navigation")
    float LaneSearchRadius = 1000.0f;

    /** Smart object search cooldown (seconds) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Navigation")
    float SmartObjectSearchCooldown = 5.0f;

    /** Interaction duration range (min) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Navigation")
    float InteractionDurationMin = 3.0f;

    /** Interaction duration range (max) */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Navigation")
    float InteractionDurationMax = 8.0f;

    // === Audio ===

    /** Enable audio LOD system */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Audio")
    bool bEnableAudioLOD = true;

    /** Audio LOD 0 distance */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Audio")
    float AudioLOD0Distance = 500.0f;

    /** Audio LOD 1 distance */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Audio")
    float AudioLOD1Distance = 2000.0f;

    /** Audio LOD 1 volume multiplier */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Audio")
    float AudioLOD1VolumeMultiplier = 0.5f;

    /** Audio cull distance */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Audio")
    float AudioCullDistance = 5000.0f;

    // === Debug ===

    /** Enable debug visualization */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Debug")
    bool bEnableDebugVisualization = false;

    /** Debug draw duration */
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Debug")
    float DebugDrawDuration = 0.0f;

    /**
     * Get the default crowd config.
     * @return Default config asset, or nullptr if not found
     */
    UFUNCTION(BlueprintPure, Category = "GSD|Crowd")
    static UGSDCrowdConfig* GetDefaultConfig();
};
```

**GSDCrowdConfig.cpp:**
```cpp
#include "DataAssets/GSDCrowdConfig.h"

UGSDCrowdConfig* UGSDCrowdConfig::GetDefaultConfig()
{
    // Load default config from asset path
    static UGSDCrowdConfig* DefaultConfig = nullptr;

    if (!DefaultConfig)
    {
        DefaultConfig = LoadObject<UGSDCrowdConfig>(
            nullptr,
            TEXT("/GSD_Crowds/Config/DefaultCrowdConfig.DefaultCrowdConfig")
        );
    }

    return DefaultConfig;
}
```

**Important:**
- All properties are EditDefaultsOnly (configured in editor, not at runtime)
- Group related properties by category
- Provide sensible defaults based on existing hardcoded values
- Static getter for convenient access
- Asset should be created at: /GSD_Crowds/Config/DefaultCrowdConfig
  </action>
  <verify>
    ```bash
    # Verify GSDCrowdConfig exists
    test -f Plugins/GSD_Crowds/Source/GSD_Crowds/Public/DataAssets/GSDCrowdConfig.h && echo "✓ GSDCrowdConfig header exists" || echo "✗ GSDCrowdConfig header missing"

    # Check for required properties
    grep -q "DetectionRadius" Plugins/GSD_Crowds/Source/GSD_Crowds/Public/DataAssets/GSDCrowdConfig.h && echo "✓ DetectionRadius defined" || echo "✗ DetectionRadius missing"
    grep -q "LOD0Distance" Plugins/GSD_Crowds/Source/GSD_Crowds/Public/DataAssets/GSDCrowdConfig.h && echo "✓ LOD distances defined" || echo "✗ LOD distances missing"
    grep -q "MaxEntityCount" Plugins/GSD_Crowds/Source/GSD_Crowds/Public/DataAssets/GSDCrowdConfig.h && echo "✓ MaxEntityCount defined" || echo "✗ MaxEntityCount missing"
    grep -q "BaseMoveSpeed" Plugins/GSD_Crowds/Source/GSD_Crowds/Public/DataAssets/GSDCrowdConfig.h && echo "✓ BaseMoveSpeed defined" || echo "✗ BaseMoveSpeed missing"

    echo "GSDCrowdConfig verification complete"
    ```
  </verify>
  <done>
    - UGSDCrowdConfig DataAsset created
    - All configurable parameters defined with defaults
    - Categories: Detection, LOD, Limits, Behavior, Navigation, Audio, Debug
    - Static getter for default config
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Processors to Use Config</name>
  <files>
    Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Processors/GSDZombieBehaviorProcessor.cpp
    Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Processors/GSDCrowdLODProcessor.cpp
  </files>
  <action>
Replace hardcoded values in processors with config lookups.

**Example: Update GSDZombieBehaviorProcessor.cpp:**

**Before (hardcoded):**
```cpp
void UGSDZombieBehaviorProcessor::Execute(FMassEntityManager& EntityManager, FMassExecutionContext& Context)
{
    float DetectionRadius = 5000.0f;  // HARDCODED
    float BaseSpeed = 150.0f;  // HARDCODED
    // ... processing logic
}
```

**After (config-driven):**
```cpp
#include "DataAssets/GSDCrowdConfig.h"

void UGSDZombieBehaviorProcessor::Execute(FMassEntityManager& EntityManager, FMassExecutionContext& Context)
{
    // Get config
    UGSDCrowdConfig* Config = UGSDCrowdConfig::GetDefaultConfig();
    if (!Config)
    {
        UE_LOG(LogGSDCrowds, Warning, TEXT("No crowd config found, using defaults"));
        return;
    }

    float DetectionRadius = Config->DetectionRadius;
    float BaseSpeed = Config->BaseMoveSpeed;

    // Apply speed variation
    float SpeedVariation = Config->SpeedVariationPercent;
    float Speed = BaseSpeed * FMath::FRandRange(1.0f - SpeedVariation, 1.0f + SpeedVariation);

    // ... processing logic using Config values
}
```

**Values to Replace:**

1. **GSDZombieBehaviorProcessor.cpp:**
   - Detection radius: 5000.0f -> Config->DetectionRadius
   - Base speed: hardcoded values -> Config->BaseMoveSpeed
   - Speed variation: 0.2f -> Config->SpeedVariationPercent
   - Wandering radius -> Config->WanderingRadius

2. **GSDCrowdLODProcessor.cpp:**
   - LOD 0 distance -> Config->LOD0Distance
   - LOD 1 distance -> Config->LOD1Distance
   - LOD 2 distance -> Config->LOD2Distance
   - LOD 3 cull distance -> Config->LOD3CullDistance
   - Audio LOD distances -> Config->AudioLOD0Distance, etc.

**Pattern to Follow:**
```cpp
// 1. Get config at start of Execute()
UGSDCrowdConfig* Config = UGSDCrowdConfig::GetDefaultConfig();

// 2. Check if config exists
if (!Config)
{
    // Log warning and use fallback or return
    return;
}

// 3. Use config values instead of hardcoded
float Value = Config->PropertyName;

// 4. Document which config property replaces which hardcoded value
```

**Important:**
- Get config once at start of Execute()
- Handle null config gracefully (log warning)
- Replace ALL hardcoded values, not just some
- Keep logic the same, only replace values
- Do NOT break existing functionality
  </action>
  <verify>
    ```bash
    # Verify hardcoded values replaced
    if grep -q "5000\.0f" Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Processors/GSDZombieBehaviorProcessor.cpp; then
      echo "WARNING: Hardcoded 5000.0f still present"
    else
      echo "✓ Hardcoded detection radius replaced"
    fi

    # Verify config usage
    grep -q "GetDefaultConfig" Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Processors/GSDZombieBehaviorProcessor.cpp && echo "✓ Config lookup added" || echo "✗ Config lookup missing"
    grep -q "Config->DetectionRadius" Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Processors/GSDZombieBehaviorProcessor.cpp && echo "✓ Using Config->DetectionRadius" || echo "✗ Config->DetectionRadius missing"
    grep -q "Config->BaseMoveSpeed" Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Processors/GSDZombieBehaviorProcessor.cpp && echo "✓ Using Config->BaseMoveSpeed" || echo "✗ Config->BaseMoveSpeed missing"

    echo "Processor update verification complete"
    ```
  </verify>
  <done>
    - All hardcoded values in GSDZombieBehaviorProcessor replaced
    - All hardcoded values in GSDCrowdLODProcessor replaced
    - Config lookup pattern established
    - Null config handling added
    - Existing functionality preserved
  </done>
</task>

</tasks>

<verification>
1. UGSDCrowdConfig DataAsset created with all parameters
2. All hardcoded values identified and documented
3. Processors updated to use config lookups
4. Null config handling present
5. No functionality regression
</verification>

<success_criteria>
- UGSDCrowdConfig with DetectionRadius, LODDistances, MaxEntityCount, behavior params
- GSDZombieBehaviorProcessor uses Config->DetectionRadius instead of 5000.0f
- GSDCrowdLODProcessor uses Config->LOD0Distance, etc. instead of hardcoded values
- All timing values (search cooldown, interaction duration) configurable
- Values match existing hardcoded defaults for backward compatibility
</success_criteria>

<output>
After completion, create `.planning/phases/11-council-fixes/11-07-SUMMARY.md`
</output>
