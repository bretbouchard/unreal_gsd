---
phase: 11-council-fixes
plan: 04
type: execute
wave: 2
depends_on: [11-03]
files_modified:
  - .github/workflows/unreal-ci.yml
  - .github/workflows/README.md
autonomous: true
must_haves:
  truths:
    - "GitHub Actions workflow runs on every push"
    - "Workflow compiles all GSD plugins"
    - "Workflow runs automation tests and reports results"
    - "Workflow exits with proper exit codes (0=success, 1=fail)"
  artifacts:
    - path: ".github/workflows/unreal-ci.yml"
      provides: "CI/CD pipeline configuration"
      contains: "on: push, run tests, exit codes"
    - path: ".github/workflows/README.md"
      provides: "Workflow documentation"
      min_lines: 30
  key_links:
    - from: "GitHub Actions"
      to: "Unreal Automation Tests"
      via: "UE4Editor-Cmd.exe"
      pattern: "SessionFrontend|Automation"
---

<objective>
Create GitHub Actions CI/CD pipeline for automated testing on every push.

Purpose: Establish continuous integration that automatically builds and tests all GSD plugins on every commit. Council review identified missing CI/CD pipeline as critical for maintaining code quality.

Output: GitHub Actions workflow that compiles plugins, runs automation tests, and reports results with proper exit codes.

Council Issues: #5, #24, #25, #27 - No CI/CD pipeline, no JSON output, no exit codes, no headless execution (Validation Rick, P0 Critical)
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-council-fixes/11-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions Workflow</name>
  <files>
    .github/workflows/unreal-ci.yml
  </files>
  <action>
Create GitHub Actions workflow for Unreal Engine CI/CD.

**Workflow File (.github/workflows/unreal-ci.yml):**
```yaml
name: Unreal GSD CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

env:
  UE_ROOT: "C:\\Program Files\\Epic Games\\UE_5.4"
  PROJECT_NAME: "GSD_Platform"

jobs:
  build-and-test:
    name: Build and Test
    runs-on: windows-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      with:
        lfs: true

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2

    - name: Generate Project Files
      run: |
        "%UE_ROOT%\\Engine\\Build\\BatchFiles\\Build.bat" -projectfiles -project="%CD%\\%PROJECT_NAME%.uproject" -game -rocket -progress

    - name: Build Development Editor
      run: |
        "%UE_ROOT%\\Engine\\Build\\BatchFiles\\Build.bat" ^
          %PROJECT_NAME%Editor ^
          Win64 ^
          Development ^
          "%CD%\\%PROJECT_NAME%.uproject" ^
          -waitmutex ^
          -NoHotReloadFromIDE

    - name: Run Automation Tests
      id: run_tests
      run: |
        "%UE_ROOT%\\Engine\\Binaries\\Win64\\UnrealEditor-Cmd.exe" ^
          "%CD%\\%PROJECT_NAME%.uproject" ^
          -ExecCmds="Automation RunTests GSD;Quit" ^
          -TestExit="Automation Test Queue Empty" ^
          -unattended ^
          -nopause ^
          -NullRHI ^
          -log ^
          -logcmds="LogAutomationController Verbose" ^
          -ABSLOG="%CD%\\Saved\\Logs\\AutomationTest.log"

        # Check test results
        $testLog = Get-Content "%CD%\\Saved\\Logs\\AutomationTest.log" -Raw
        if ($testLog -match "Automation: ([0-9]+) tests total, ([0-9]+) success, ([0-9]+) fail") {
          $total = $matches[1]
          $success = $matches[2]
          $fail = $matches[3]
          Write-Host "Test Results: $success/$total passed, $fail failed"

          if ($fail -gt 0) {
            Write-Host "##vso[task.complete result=Failed;]Tests failed"
            exit 1
          }
        }

    - name: Upload Test Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: test-results
        path: |
          Saved/Logs/AutomationTest.log
          Saved/Logs/*.log

    - name: Build Report
      if: always()
      run: |
        echo "## Build Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **Build Status:** ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Platform:** Windows" >> $GITHUB_STEP_SUMMARY
        echo "- **Configuration:** Development Editor" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Test results available in Artifacts." >> $GITHUB_STEP_SUMMARY

  # Optional: Linux build job
  build-linux:
    name: Build Linux
    runs-on: ubuntu-latest
    if: false  # Disable until Linux setup is ready

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    # Linux build steps would go here
```

**Important Considerations:**

1. **Self-Hosted Runners:**
   - GitHub-hosted runners may not have UE installed
   - Consider using self-hosted runners with UE pre-installed
   - Alternative: Use Docker container with UE

2. **Unreal Engine Setup:**
   - Workflow assumes UE 5.4 is installed at C:\Program Files\Epic Games\UE_5.4
   - Adjust UE_ROOT for your environment
   - May need to cache UE between runs

3. **Test Execution:**
   - Uses UnrealEditor-Cmd.exe for headless execution
   - -NullRHI flag prevents rendering requirements
   - -unattended and -nopause for CI environment
   - TestExit determines when to quit

4. **Exit Codes:**
   - Exit 0 = success
   - Exit 1 = failure (build or test failure)
   - Proper exit codes enable pass/fail status

5. **JSON Output (Future Enhancement):**
   - Can parse AutomationTest.log for JSON results
   - Use -ReportExportPath to export JSON reports
   - Custom script can convert to JUnit XML

**Alternative for Self-Hosted Runner:**
```yaml
jobs:
  build-and-test:
    runs-on: self-hosted
    env:
      UE_ROOT: "D:\\UE_5.4"
```
  </action>
  <verify>
    ```bash
    # Verify workflow file exists
    test -f .github/workflows/unreal-ci.yml && echo "✓ Workflow file exists" || echo "✗ Workflow file missing"

    # Verify workflow structure
    grep -q "on: push" .github/workflows/unreal-ci.yml && echo "✓ Push trigger configured" || echo "✗ Push trigger missing"
    grep -q "Automation RunTests" .github/workflows/unreal-ci.yml && echo "✓ Test execution configured" || echo "✗ Test execution missing"
    grep -q "exit 1" .github/workflows/unreal-ci.yml && echo "✓ Exit codes configured" || echo "✗ Exit codes missing"

    echo "Workflow verification complete"
    ```
  </verify>
  <done>
    - GitHub Actions workflow created at .github/workflows/unreal-ci.yml
    - Workflow triggers on push to main/develop
    - Workflow builds Development Editor configuration
    - Workflow runs automation tests with proper exit codes
    - Test artifacts uploaded on completion
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Workflow Documentation</name>
  <files>
    .github/workflows/README.md
  </files>
  <action>
Create documentation for CI/CD workflow setup and usage.

**Documentation File (.github/workflows/README.md):**
```markdown
# GSD Platform CI/CD Pipeline

## Overview

This document describes the continuous integration and continuous deployment (CI/CD) pipeline for the Unreal GSD Platform.

## Workflow: unreal-ci.yml

### Triggers

- **Push:** Runs on every push to `main` and `develop` branches
- **Pull Request:** Runs on all PRs targeting `main`

### Jobs

#### 1. Build and Test

**Steps:**
1. Checkout repository (with LFS support)
2. Setup MSBuild
3. Generate Unreal project files
4. Build Development Editor configuration
5. Run automation tests
6. Upload test results as artifacts

**Artifacts:**
- `test-results/` - Test logs and automation results

### Requirements

#### Self-Hosted Runner Setup

For best performance, use a self-hosted runner with Unreal Engine pre-installed:

1. **Install Unreal Engine 5.4:**
   - Download from Epic Games Launcher
   - Install to standard location (e.g., C:\Program Files\Epic Games\UE_5.4)

2. **Configure Self-Hosted Runner:**
   ```bash
   # Download GitHub Actions runner
   ./config.sh --url https://github.com/YOUR_ORG/YOUR_REPO --token YOUR_TOKEN

   # Install as service
   sudo ./svc.sh install
   sudo ./svc.sh start
   ```

3. **Set Environment Variables:**
   - UE_ROOT: Path to Unreal Engine installation

#### GitHub-Hosted Runner Alternative

If using GitHub-hosted runners:

1. **Cache UE Installation:**
   - Use actions/cache to cache UE between runs
   - Initial run will be slow (UE download)

2. **Docker Alternative:**
   - Create Docker image with UE pre-installed
   - Use container action

### Test Execution

**Automation Tests:**
- All tests matching "GSD.*" pattern are executed
- Tests run in headless mode (-NullRHI)
- Results logged to Saved/Logs/AutomationTest.log

**Exit Codes:**
- 0 = All tests passed
- 1 = One or more tests failed

**JSON Output (Future):**
```bash
# Enable JSON report export
-ReportExportPath="%CD%\\Saved\\Reports"
```

### Troubleshooting

#### Build Fails

1. **Missing Dependencies:**
   - Ensure all GSD plugins have correct Build.cs dependencies
   - Check for missing module references

2. **Compilation Errors:**
   - Review build log for specific errors
   - Check API macros on public classes

#### Test Failures

1. **Test Discovery:**
   - Verify tests use IMPLEMENT_SIMPLE_AUTOMATION_TEST
   - Check ProductFilter flag is set

2. **Test Execution:**
   - Review AutomationTest.log for details
   - Check for null pointers or assertion failures

### Performance Optimization

1. **Incremental Builds:**
   - Workflow supports incremental compilation
   - Clean builds only on dependency changes

2. **Parallel Jobs:**
   - Build and test can run in parallel for multiple platforms
   - Use matrix strategy for platform combinations

3. **Caching:**
   - Cache UE installation
   - Cache compiled binaries
   - Cache intermediate build files

### Future Enhancements

- [ ] Add Linux build support
- [ ] Add macOS build support
- [ ] Add code coverage reporting
- [ ] Add performance benchmarking
- [ ] Add static analysis (Clang-Tidy)
- [ ] Add documentation generation

### Contact

For CI/CD issues, contact: Bret Bouchard
```

**Important:**
- Document self-hosted runner setup (recommended)
- Explain test execution and exit codes
- Provide troubleshooting guide
- List future enhancements
  </action>
  <verify>
    ```bash
    # Verify documentation exists
    test -f .github/workflows/README.md && echo "✓ Documentation exists" || echo "✗ Documentation missing"

    # Check documentation completeness
    grep -q "Self-Hosted Runner" .github/workflows/README.md && echo "✓ Self-hosted setup documented" || echo "✗ Self-hosted setup missing"
    grep -q "Exit Codes" .github/workflows/README.md && echo "✓ Exit codes documented" || echo "✗ Exit codes missing"
    grep -q "Troubleshooting" .github/workflows/README.md && echo "✓ Troubleshooting documented" || echo "✗ Troubleshooting missing"

    echo "Documentation verification complete"
    ```
  </verify>
  <done>
    - Workflow documentation created
    - Self-hosted runner setup documented
    - Test execution and exit codes explained
    - Troubleshooting guide provided
    - Future enhancements listed
  </done>
</task>

</tasks>

<verification>
1. GitHub Actions workflow file exists and is valid YAML
2. Workflow triggers on push to main/develop
3. Workflow runs automation tests with proper exit codes
4. Documentation is comprehensive and accurate
</verification>

<success_criteria>
- .github/workflows/unreal-ci.yml created and valid
- Workflow builds Development Editor
- Workflow runs automation tests headlessly
- Workflow exits with proper codes (0=success, 1=fail)
- Documentation covers setup and troubleshooting
</success_criteria>

<output>
After completion, create `.planning/phases/11-council-fixes/11-04-SUMMARY.md`
</output>
