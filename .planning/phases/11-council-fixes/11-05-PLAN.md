---
phase: 11-council-fixes
plan: 05
type: execute
wave: 3
depends_on: [11-01, 11-02]
files_modified:
  - Plugins/GSD_Core/Source/GSD_Core/Public/Interfaces/GSDAudioInterface.h
  - Plugins/GSD_Core/Source/GSD_Audio/GSD_Audio.uplugin
  - Plugins/GSD_Audio/Source/GSD_Audio/GSD_Audio.Build.cs
  - Plugins/GSD_Audio/Source/GSD_Audio/Public/GSD_Audio.h
  - Plugins/GSD_Audio/Source/GSD_Audio/Private/GSD_Audio.cpp
  - Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h
  - Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundMixes.h
  - Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDConcurrencyRules.h
autonomous: true
must_haves:
  truths:
    - "IGSDAudioInterface exists in GSD_Core"
    - "Sound Class hierarchy is defined (Master, Music, SFX, Voice, Crowd, Ambience)"
    - "Submix chain is configured with proper routing"
    - "Concurrency rules prevent audio spam"
  artifacts:
    - path: "Plugins/GSD_Core/Source/GSD_Core/Public/Interfaces/GSDAudioInterface.h"
      provides: "Audio interface abstraction"
      contains: "UINTERFACE(BlueprintType)"
      min_lines: 40
    - path: "Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h"
      provides: "Sound class definitions"
      contains: "Master, Music, SFX, Voice"
    - path: "Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDConcurrencyRules.h"
      provides: "Audio concurrency configuration"
      contains: "CC_ZombieMoan, MaxActive"
  key_links:
    - from: "GSDSoundClasses.h"
      to: "Unreal Audio System"
      via: "USoundClass"
      pattern: "USoundClass.*Master|Music|SFX"
---

<objective>
Create core audio infrastructure with IGSDAudioInterface, Sound Class hierarchy, Submix chain, and concurrency rules.

Purpose: Establish the audio foundation for the GSD platform. Council review identified missing audio interface and infrastructure as critical for proper audio management across all systems.

Output: GSD_Audio plugin with complete audio hierarchy, interface definition, and concurrency configuration.

Council Issues: #7, #8, #9, #19 - Missing audio interface, Sound Classes, Submix chain, concurrency rules (Audio Rick, P0/P1)
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-council-fixes/11-RESEARCH.md

# Reference interface pattern
@Plugins/GSD_Core/Source/GSD_Core/Public/Interfaces/GSDSpawnableInterface.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create IGSDAudioInterface</name>
  <files>
    Plugins/GSD_Core/Source/GSD_Core/Public/Interfaces/GSDAudioInterface.h
  </files>
  <action>
Create IGSDAudioInterface in GSD_Core following the established interface pattern.

**Interface Definition:**
```cpp
#pragma once

#include "CoreMinimal.h"
#include "UObject/Interface.h"
#include "GSDAudioInterface.generated.h"

/**
 * Interface for audio systems in the GSD Platform.
 * Provides access to Sound Classes, Submixes, and audio utilities.
 */
UINTERFACE(BlueprintType, Meta = (CannotImplementInterfaceInBlueprint))
class GSD_CORE_API UGSDAudioInterface : public UInterface
{
    GENERATED_BODY()
};

class GSD_CORE_API IGSDAudioInterface
{
    GENERATED_BODY()

public:
    /**
     * Get the Master Sound Class (root of all audio).
     * @return Master Sound Class asset
     */
    UFUNCTION(BlueprintCallable, Category = "GSD|Audio")
    virtual USoundClass* GetMasterSoundClass() const = 0;

    /**
     * Get a Sound Class by name.
     * @param ClassName Name of the Sound Class (e.g., "Music", "SFX", "Voice")
     * @return Sound Class asset, or nullptr if not found
     */
    UFUNCTION(BlueprintCallable, Category = "GSD|Audio")
    virtual USoundClass* GetSoundClass(FName ClassName) const = 0;

    /**
     * Get a Sound Submix by name.
     * @param SubmixName Name of the Submix (e.g., "Reverb", "EQ", "Master")
     * @return Sound Submix asset, or nullptr if not found
     */
    UFUNCTION(BlueprintCallable, Category = "GSD|Audio")
    virtual USoundSubmixBase* GetSubmix(FName SubmixName) const = 0;

    /**
     * Set volume for a Sound Class.
     * @param ClassName Name of the Sound Class
     * @param Volume New volume level (0.0 to 1.0)
     */
    UFUNCTION(BlueprintCallable, Category = "GSD|Audio")
    virtual void SetSoundClassVolume(FName ClassName, float Volume) = 0;

    /**
     * Mute or unmute a Sound Class.
     * @param ClassName Name of the Sound Class
     * @param bMute True to mute, false to unmute
     */
    UFUNCTION(BlueprintCallable, Category = "GSD|Audio")
    virtual void SetSoundClassMuted(FName ClassName, bool bMute) = 0;

    /**
     * Play a sound at a specific location with spatialization.
     * @param Sound Sound asset to play
     * @param Location World location
     * @param ClassName Sound Class to use for routing
     * @param Volume Volume multiplier (default: 1.0)
     * @param Pitch Pitch multiplier (default: 1.0)
     */
    UFUNCTION(BlueprintCallable, Category = "GSD|Audio")
    virtual void PlaySoundAtLocation(
        USoundBase* Sound,
        FVector Location,
        FName ClassName,
        float Volume = 1.0f,
        float Pitch = 1.0f
    ) = 0;
};
```

**Important:**
- Use UINTERFACE(BlueprintType) for Blueprint access
- Meta = (CannotImplementInterfaceInBlueprint) - C++ only implementation
- All methods are pure virtual (= 0)
- Provide BlueprintCallable for all methods
- Follow naming conventions from GSDSpawnableInterface
  </action>
  <verify>
    ```bash
    # Verify interface exists
    test -f Plugins/GSD_Core/Source/GSD_Core/Public/Interfaces/GSDAudioInterface.h && echo "✓ Interface file exists" || echo "✗ Interface file missing"

    # Verify interface structure
    grep -q "UINTERFACE(BlueprintType" Plugins/GSD_Core/Source/GSD_Core/Public/Interfaces/GSDAudioInterface.h && echo "✓ UINTERFACE declared" || echo "✗ UINTERFACE missing"
    grep -q "class.*IGSDAudioInterface" Plugins/GSD_Core/Source/GSD_Core/Public/Interfaces/GSDAudioInterface.h && echo "✓ Interface class declared" || echo "✗ Interface class missing"
    grep -q "GetMasterSoundClass" Plugins/GSD_Core/Source/GSD_Core/Public/Interfaces/GSDAudioInterface.h && echo "✓ GetMasterSoundClass method exists" || echo "✗ GetMasterSoundClass missing"

    echo "Interface verification complete"
    ```
  </verify>
  <done>
    - IGSDAudioInterface created in GSD_Core
    - Interface follows established pattern
    - Methods for Sound Classes, Submixes, volume, muting, spatial audio
    - Blueprint-accessible via UINTERFACE(BlueprintType)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GSD_Audio Plugin Structure</name>
  <files>
    Plugins/GSD_Audio/GSD_Audio.uplugin
    Plugins/GSD_Audio/Source/GSD_Audio/GSD_Audio.Build.cs
    Plugins/GSD_Audio/Source/GSD_Audio/Public/GSD_Audio.h
    Plugins/GSD_Audio/Source/GSD_Audio/Private/GSD_Audio.cpp
    Plugins/GSD_Audio/Resources/Icon128.png
  </files>
  <action>
Create GSD_Audio plugin structure.

**Plugin Manifest (GSD_Audio.uplugin):**
```json
{
  "FileVersion": 3,
  "Version": 1,
  "VersionName": "1.0",
  "FriendlyName": "GSD Audio",
  "Description": "Audio infrastructure for GSD Platform - Sound Classes, Submixes, and utilities",
  "Category": "GSD",
  "CreatedBy": "Bret Bouchard",
  "CreatedByURL": "",
  "DocsURL": "",
  "MarketplaceURL": "",
  "SupportURL": "",
  "CanContainContent": true,
  "IsBetaVersion": false,
  "IsExperimentalVersion": false,
  "Installed": false,
  "Modules": [
    {
      "Name": "GSD_Audio",
      "Type": "Runtime",
      "LoadingPhase": "Default"
    }
  ],
  "Plugins": [
    {
      "Name": "GSD_Core",
      "Enabled": true
    },
    {
      "Name": "AudioEditor",
      "Enabled": true
    }
  ]
}
```

**Build.cs Configuration:**
```csharp
using UnrealBuildTool;

public class GSD_Audio : ModuleRules
{
    public GSD_Audio(ReadOnlyTargetRules Target) : base(Target)
    {
        PCHUsage = PCHUsageMode.UseExplicitOrSharedPCHs;

        PublicDependencyModuleNames.AddRange(new string[] {
            "Core",
            "CoreUObject",
            "Engine",
            "GSD_Core",
            "AudioEditor"
        });

        PrivateDependencyModuleNames.AddRange(new string[] {
            "Engine"
        });
    }
}
```

**Module Header and Implementation:**
Standard module pattern (see GSD_Vehicles for reference).
  </action>
  <verify>
    ```bash
    # Verify plugin structure
    test -f Plugins/GSD_Audio/GSD_Audio.uplugin && echo "✓ Plugin manifest exists" || echo "✗ Plugin manifest missing"
    test -f Plugins/GSD_Audio/Source/GSD_Audio/GSD_Audio.Build.cs && echo "✓ Build.cs exists" || echo "✗ Build.cs missing"
    test -f Plugins/GSD_Audio/Source/GSD_Audio/Public/GSD_Audio.h && echo "✓ Header exists" || echo "✗ Header missing"

    echo "Plugin structure verification complete"
    ```
  </verify>
  <done>
    - GSD_Audio plugin created
    - CanContainContent: true (for audio assets)
    - Depends on GSD_Core and AudioEditor
    - Plugin compiles successfully
  </done>
</task>

<task type="auto">
  <name>Task 3: Define Sound Class Hierarchy</name>
  <files>
    Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h
  </files>
  <action>
Define Sound Class hierarchy constants and structure.

**Sound Class Definitions:**
```cpp
#pragma once

#include "CoreMinimal.h"
#include "Sound/SoundClass.h"
#include "GSDSoundClasses.generated.h"

/**
 * Sound Class hierarchy for GSD Platform.
 *
 * Hierarchy:
 *   Master
 *   ├── Music
 *   ├── SFX
 *   │   ├── Voice
 *   │   ├── Crowd
 *   │   └── Ambience
 *   └── UI
 */
namespace GSDSoundClasses
{
    // Root sound class
    static const FName Master = FName(TEXT("Master"));

    // Primary categories
    static const FName Music = FName(TEXT("Music"));
    static const FName SFX = FName(TEXT("SFX"));
    static const FName UI = FName(TEXT("UI"));

    // SFX sub-categories
    static const FName Voice = FName(TEXT("Voice"));
    static const FName Crowd = FName(TEXT("Crowd"));
    static const FName Ambience = FName(TEXT("Ambience"));

    // Vehicle-specific
    static const FName Vehicle = FName(TEXT("Vehicle"));
    static const FName VehicleEngine = FName(TEXT("VehicleEngine"));
    static const FName VehicleCollision = FName(TEXT("VehicleCollision"));

    // Event-specific
    static const FName Event = FName(TEXT("Event"));
    static const FName Construction = FName(TEXT("Construction"));
    static const FName Party = FName(TEXT("Party"));
}

/**
 * Sound Class asset paths for loading.
 */
namespace GSDSoundClassPaths
{
    static const FString Master = TEXT("/GSD_Audio/Audio/SoundClasses/Master.Master");
    static const FString Music = TEXT("/GSD_Audio/Audio/SoundClasses/Music.Music");
    static const FString SFX = TEXT("/GSD_Audio/Audio/SoundClasses/SFX.SFX");
    static const FString Voice = TEXT("/GSD_Audio/Audio/SoundClasses/Voice.Voice");
    static const FString Crowd = TEXT("/GSD_Audio/Audio/SoundClasses/Crowd.Crowd");
    static const FString Ambience = TEXT("/GSD_Audio/Audio/SoundClasses/Ambience.Ambience");
}

/**
 * Default volume levels for sound classes.
 */
namespace GSDSoundClassDefaults
{
    static constexpr float MasterVolume = 1.0f;
    static constexpr float MusicVolume = 0.7f;
    static constexpr float SFXVolume = 1.0f;
    static constexpr float VoiceVolume = 1.0f;
    static constexpr float CrowdVolume = 0.8f;
    static constexpr float AmbienceVolume = 0.6f;
}
```

**Asset Creation Note:**
The actual USoundClass assets must be created in Unreal Editor:
- Content Browser -> Add -> Sounds -> Sound Class
- Create hierarchy: Master -> Music, SFX, UI -> Voice, Crowd, Ambience
- Save to: /GSD_Audio/Audio/SoundClasses/

**Important:**
- Define constants for Sound Class names
- Provide asset paths for loading
- Document hierarchy structure
- Define default volume levels
  </action>
  <verify>
    ```bash
    # Verify Sound Classes header
    test -f Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h && echo "✓ Sound Classes header exists" || echo "✗ Sound Classes header missing"

    # Check for required categories
    grep -q "Master" Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h && echo "✓ Master defined" || echo "✗ Master missing"
    grep -q "Music" Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h && echo "✓ Music defined" || echo "✗ Music missing"
    grep -q "SFX" Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h && echo "✓ SFX defined" || echo "✗ SFX missing"
    grep -q "Voice" Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h && echo "✓ Voice defined" || echo "✗ Voice missing"
    grep -q "Crowd" Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h && echo "✓ Crowd defined" || echo "✗ Crowd missing"
    grep -q "Ambience" Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDSoundClasses.h && echo "✓ Ambience defined" || echo "✗ Ambience missing"

    echo "Sound Class verification complete"
    ```
  </verify>
  <done>
    - Sound Class hierarchy defined with 6 primary categories
    - Constants for Sound Class names
    - Asset paths for loading
    - Default volume levels specified
  </done>
</task>

<task type="auto">
  <name>Task 4: Define Audio Concurrency Rules</name>
  <files>
    Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDConcurrencyRules.h
  </files>
  <action>
Define audio concurrency rules to prevent audio spam.

**Concurrency Rule Definitions:**
```cpp
#pragma once

#include "CoreMinimal.h"
#include "Sound/SoundConcurrency.h"
#include "GSDConcurrencyRules.generated.h"

/**
 * Audio concurrency rule names for GSD Platform.
 * These prevent too many sounds of the same type playing simultaneously.
 */
namespace GSDConcurrencyRules
{
    // Crowd sounds - limit concurrent zombie moans
    static const FName CC_ZombieMoan = FName(TEXT("CC_ZombieMoan"));
    static const FName CC_CrowdAmbient = FName(TEXT("CC_CrowdAmbient"));

    // Vehicle sounds - limit engine sounds
    static const FName CC_VehicleEngine = FName(TEXT("CC_VehicleEngine"));
    static const FName CC_VehicleCollision = FName(TEXT("CC_VehicleCollision"));

    // Event sounds - limit repeating event audio
    static const FName CC_EventAmbient = FName(TEXT("CC_EventAmbient"));
    static const FName CC_Construction = FName(TEXT("CC_Construction"));
    static const FName CC_Party = FName(TEXT("CC_Party"));

    // UI sounds - prevent UI spam
    static const FName CC_UI = FName(TEXT("CC_UI"));

    // Voice - prevent voice overlap
    static const FName CC_Voice = FName(TEXT("CC_Voice"));
}

/**
 * Concurrency rule configuration.
 */
namespace GSDConcurrencyConfig
{
    // Maximum active sounds for each concurrency rule
    struct FConcurrencySettings
    {
        int32 MaxActiveSounds;
        ESoundConcurrencyResolution ResolutionRule;
    };

    static const FConcurrencySettings ZombieMoan = {
        8,  // Max 8 zombie moans at once
        ESoundConcurrencyResolution::StopQuietest
    };

    static const FConcurrencySettings CrowdAmbient = {
        4,  // Max 4 crowd ambient sounds
        ESoundConcurrencyResolution::StopQuietest
    };

    static const FConcurrencySettings VehicleEngine = {
        10,  // Max 10 vehicle engines (one per nearby vehicle)
        ESoundConcurrencyResolution::StopQuietest
    };

    static const FConcurrencySettings VehicleCollision = {
        5,  // Max 5 collision sounds
        ESoundConcurrencyResolution::StopQuietest
    };

    static const FConcurrencySettings EventAmbient = {
        3,  // Max 3 event ambient sounds
        ESoundConcurrencyResolution::StopQuietest
    };

    static const FConcurrencySettings UI = {
        2,  // Max 2 UI sounds at once
        ESoundConcurrencyResolution::StopQuietest
    };

    static const FConcurrencySettings Voice = {
        1,  // Only 1 voice at a time
        ESoundConcurrencyResolution::StopQuietest
    };
}
```

**Asset Creation Note:**
The actual USoundConcurrency assets must be created in Unreal Editor:
- Content Browser -> Add -> Sounds -> Sound Concurrency
- Configure Max Active Sounds and Resolution Rule
- Save to: /GSD_Audio/Audio/Concurrency/

**Important:**
- Define concurrency rule names as constants
- Provide configuration struct for settings
- Document max active sounds for each rule
- Use StopQuietest for most rules
  </action>
  <verify>
    ```bash
    # Verify Concurrency Rules header
    test -f Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDConcurrencyRules.h && echo "✓ Concurrency Rules header exists" || echo "✗ Concurrency Rules header missing"

    # Check for required rules
    grep -q "CC_ZombieMoan" Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDConcurrencyRules.h && echo "✓ ZombieMoan rule defined" || echo "✗ ZombieMoan rule missing"
    grep -q "CC_VehicleEngine" Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDConcurrencyRules.h && echo "✓ VehicleEngine rule defined" || echo "✗ VehicleEngine rule missing"
    grep -q "MaxActiveSounds" Plugins/GSD_Audio/Source/GSD_Audio/Public/Audio/GSDConcurrencyRules.h && echo "✓ MaxActiveSounds config exists" || echo "✗ MaxActiveSounds config missing"

    echo "Concurrency Rules verification complete"
    ```
  </verify>
  <done>
    - Concurrency rule names defined for all audio categories
    - Configuration struct with max active sounds
    - StopQuietest resolution for all rules
    - Prevents audio spam across all systems
  </done>
</task>

</tasks>

<verification>
1. IGSDAudioInterface exists in GSD_Core
2. GSD_Audio plugin compiles successfully
3. Sound Class hierarchy defined with 6+ categories
4. Concurrency rules defined for all audio types
5. Asset paths documented for editor creation
</verification>

<success_criteria>
- IGSDAudioInterface created with proper Blueprint support
- GSD_Audio plugin structure established
- Sound Class hierarchy: Master, Music, SFX, Voice, Crowd, Ambience
- Concurrency rules: CC_ZombieMoan (Max 8), CC_VehicleEngine (Max 10), etc.
- Constants and configurations defined for all audio systems
</success_criteria>

<output>
After completion, create `.planning/phases/11-council-fixes/11-05-SUMMARY.md`
</output>
