---
phase: 09-event-implementations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDDensityReduceModifier.h
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDDensityReduceModifier.cpp
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDSafeZoneModifier.h
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDSafeZoneModifier.cpp
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDNavigationBlockModifier.h
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDNavigationBlockModifier.cpp
autonomous: true

must_haves:
  truths:
    - "DensityReduceModifier decreases zombie spawn rates in an area"
    - "SafeZoneModifier creates near-zero spawn zones for survivor safety"
    - "NavigationBlockModifier prevents AI from entering blocked areas"
    - "All modifiers follow Apply/Remove pattern from Phase 8"
  artifacts:
    - path: "Plugins/GSD_DailyEvents/.../Modifiers/GSDDensityReduceModifier.h"
      provides: "Density reduction modifier for Bonfire event"
      exports: ["UGSDDensityReduceModifier"]
    - path: "Plugins/GSD_DailyEvents/.../Modifiers/GSDSafeZoneModifier.h"
      provides: "Safe zone modifier for Block Party event"
      exports: ["UGSDSafeZoneModifier"]
    - path: "Plugins/GSD_DailyEvents/.../Modifiers/GSDNavigationBlockModifier.h"
      provides: "Navigation blocking for Construction event"
      exports: ["UGSDNavigationBlockModifier"]
  key_links:
    - from: "GSDDensityReduceModifier::ApplyModifier"
      to: "GSDCrowdManagerSubsystem::AddDensityModifier"
      via: "Density multiplier < 1.0"
      pattern: "AddDensityModifier\\(ModifierTag, Center, Radius, Multiplier\\)"
    - from: "GSDSafeZoneModifier::ApplyModifier"
      to: "GSDCrowdManagerSubsystem::AddDensityModifier"
      via: "Near-zero multiplier (0.01)"
      pattern: "AddDensityModifier.*0\\.01"
    - from: "GSDNavigationBlockModifier::ApplyModifier"
      to: "NavModifierVolume or ZoneGraphSubsystem"
      via: "Block AI navigation in area"
      pattern: "(NavModifierVolume|ZoneGraph)"
---

<objective>
Create three additional event modifiers that enable concrete daily events to modify gameplay meaningfully.

Purpose: These modifiers provide the gameplay-changing effects that events need - reducing density for Bonfire, creating safe zones for Block Party, and blocking navigation for Construction.
Output: Three UGSDEventModifierConfig subclasses with Apply/Remove implementations.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

## Phase 8 Context (Event Infrastructure)

@.planning/phases/08-event-system-core/08-04-SUMMARY.md

**Existing Pattern - GSDDensityBoostModifier:**
- Extends UGSDEventModifierConfig
- ApplyModifier calls GSDCrowdManagerSubsystem->AddDensityModifier()
- RemoveModifier calls GSDCrowdManagerSubsystem->RemoveDensityModifier()
- Uses ModifierTag for identification

**GSDCrowdManagerSubsystem API:**
```cpp
void AddDensityModifier(FGameplayTag ModifierTag, FVector Center, float Radius, float Multiplier);
void RemoveDensityModifier(FGameplayTag ModifierTag);
float GetDensityMultiplierAtLocation(FVector Location) const;
```

## Research Context

@.planning/phases/09-event-implementations/09-RESEARCH.md

**Pitfall 2 - Modifier State Leak:**
- Always pair Apply with Remove
- Store applied modifiers in AppliedModifiers array
- Use finally-style cleanup patterns
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Density Reduce Modifier</name>
  <files>
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDDensityReduceModifier.h
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDDensityReduceModifier.cpp
  </files>
  <action>
Create UGSDDensityReduceModifier that decreases spawn density in an area.

**Header (GSDDensityReduceModifier.h):**
```cpp
#pragma once

#include "CoreMinimal.h"
#include "DataAssets/GSDEventModifierConfig.h"
#include "GSDDensityReduceModifier.generated.h"

/**
 * Concrete modifier that decreases spawn density in an area.
 * Used by Bonfire event to create low-density zones.
 *
 * Inverse of GSDDensityBoostModifier - reduces instead of boosts.
 */
UCLASS(BlueprintType, Category = "GSD|Events|Modifiers")
class GSD_DAILYEVENTS_API UGSDDensityReduceModifier : public UGSDEventModifierConfig
{
    GENERATED_BODY()

public:
    UGSDDensityReduceModifier();

    //-- Density Settings --
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Density")
    float DensityMultiplier = 0.25f;  // 25% of normal density

    //-- UGSDEventModifierConfig Interface --
    virtual void ApplyModifier_Implementation(UObject* WorldContext, FVector Center, float IntensityMultiplier) override;
    virtual void RemoveModifier_Implementation(UObject* WorldContext) override;
};
```

**Implementation (GSDDensityReduceModifier.cpp):**
```cpp
#include "Modifiers/GSDDensityReduceModifier.h"
#include "Subsystems/GSDCrowdManagerSubsystem.h"
#include "Kismet/GameplayStatics.h"
#include "GameFramework/GameStateBase.h"

UGSDDensityReduceModifier::UGSDDensityReduceModifier()
{
    ModifierTag = FGameplayTag::RequestGameplayTag(FName("Event.Modifier.DensityReduce"));
}

void UGSDDensityReduceModifier::ApplyModifier_Implementation(UObject* WorldContext, FVector Center, float IntensityMultiplier)
{
    if (!WorldContext)
    {
        GSDEVENT_WARN(TEXT("DensityReduceModifier: Null WorldContext"));
        return;
    }

    UWorld* World = WorldContext->GetWorld();
    if (!World)
    {
        GSDEVENT_WARN(TEXT("DensityReduceModifier: Null World"));
        return;
    }

    UGSDCrowdManagerSubsystem* CrowdManager = World->GetSubsystem<UGSDCrowdManagerSubsystem>();
    if (!CrowdManager)
    {
        GSDEVENT_WARN(TEXT("DensityReduceModifier: CrowdManager not found"));
        return;
    }

    // Calculate effective multiplier (reduced by intensity)
    float EffectiveMultiplier = DensityMultiplier * (1.0f / FMath::Max(0.1f, IntensityMultiplier));
    EffectiveMultiplier = FMath::Clamp(EffectiveMultiplier, 0.01f, 1.0f);

    // Apply density reduction
    CrowdManager->AddDensityModifier(ModifierTag, Center, Radius, EffectiveMultiplier);

    GSDEVENT_LOG(TEXT("DensityReduceModifier applied: Center=%s Radius=%.1f Multiplier=%.2f"),
        *Center.ToString(), Radius, EffectiveMultiplier);
}

void UGSDDensityReduceModifier::RemoveModifier_Implementation(UObject* WorldContext)
{
    if (!WorldContext)
    {
        // Still try to remove - modifier might persist
        GSDEVENT_LOG(TEXT("DensityReduceModifier: Removing with null context"));
    }

    UWorld* World = WorldContext ? WorldContext->GetWorld() : nullptr;
    if (!World)
    {
        GSDEVENT_WARN(TEXT("DensityReduceModifier: Cannot remove - null world"));
        return;
    }

    UGSDCrowdManagerSubsystem* CrowdManager = World->GetSubsystem<UGSDCrowdManagerSubsystem>();
    if (!CrowdManager)
    {
        GSDEVENT_WARN(TEXT("DensityReduceModifier: CrowdManager not found for removal"));
        return;
    }

    CrowdManager->RemoveDensityModifier(ModifierTag);

    GSDEVENT_LOG(TEXT("DensityReduceModifier removed"));
}
```

**Key Design Decisions:**
- Follow GSDDensityBoostModifier pattern exactly (Phase 8)
- DensityMultiplier defaults to 0.25 (25% spawn rate)
- Intensity scales reduction (higher intensity = more reduction)
- Always call RemoveModifier even with null context (Pitfall 2 prevention)
</action>
  <verify>
    # Verify header exists with correct class declaration
    grep -q "class GSD_DAILYEVENTS_API UGSDDensityReduceModifier" \
      Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDDensityReduceModifier.h

    # Verify implementation calls GSDCrowdManagerSubsystem
    grep -q "AddDensityModifier" \
      Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDDensityReduceModifier.cpp

    grep -q "RemoveDensityModifier" \
      Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDDensityReduceModifier.cpp

    echo "DensityReduceModifier verified"
  </verify>
  <done>DensityReduceModifier compiles and follows GSDDensityBoostModifier pattern with Apply/Remove calling GSDCrowdManagerSubsystem</done>
</task>

<task type="auto">
  <name>Task 2: Create Safe Zone Modifier</name>
  <files>
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDSafeZoneModifier.h
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDSafeZoneModifier.cpp
  </files>
  <action>
Create UGSDSafeZoneModifier that creates near-zero spawn zones for survivor safety.

**Header (GSDSafeZoneModifier.h):**
```cpp
#pragma once

#include "CoreMinimal.h"
#include "DataAssets/GSDEventModifierConfig.h"
#include "GSDSafeZoneModifier.generated.h"

/**
 * Concrete modifier that creates a safe zone by reducing density to near-zero.
 * Used by BlockParty event to create survivor-safe areas.
 *
 * Uses extremely low multiplier (0.01) to effectively prevent spawns.
 */
UCLASS(BlueprintType, Category = "GSD|Events|Modifiers")
class GSD_DAILYEVENTS_API UGSDSafeZoneModifier : public UGSDEventModifierConfig
{
    GENERATED_BODY()

public:
    UGSDSafeZoneModifier();

    //-- Safe Zone Settings --
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "SafeZone")
    float DensityMultiplier = 0.01f;  // 1% spawn rate = effectively blocked

    //-- UGSDEventModifierConfig Interface --
    virtual void ApplyModifier_Implementation(UObject* WorldContext, FVector Center, float IntensityMultiplier) override;
    virtual void RemoveModifier_Implementation(UObject* WorldContext) override;
};
```

**Implementation (GSDSafeZoneModifier.cpp):**
```cpp
#include "Modifiers/GSDSafeZoneModifier.h"
#include "Subsystems/GSDCrowdManagerSubsystem.h"

UGSDSafeZoneModifier::UGSDSafeZoneModifier()
{
    ModifierTag = FGameplayTag::RequestGameplayTag(FName("Event.Modifier.SafeZone"));
}

void UGSDSafeZoneModifier::ApplyModifier_Implementation(UObject* WorldContext, FVector Center, float IntensityMultiplier)
{
    if (!WorldContext) return;

    UWorld* World = WorldContext->GetWorld();
    if (!World) return;

    UGSDCrowdManagerSubsystem* CrowdManager = World->GetSubsystem<UGSDCrowdManagerSubsystem>();
    if (!CrowdManager) return;

    // Safe zone uses near-zero multiplier regardless of intensity
    // Intensity only affects radius (handled by base class)
    CrowdManager->AddDensityModifier(ModifierTag, Center, Radius * IntensityMultiplier, DensityMultiplier);

    GSDEVENT_LOG(TEXT("SafeZoneModifier applied: Center=%s Radius=%.1f"),
        *Center.ToString(), Radius * IntensityMultiplier);
}

void UGSDSafeZoneModifier::RemoveModifier_Implementation(UObject* WorldContext)
{
    UWorld* World = WorldContext ? WorldContext->GetWorld() : nullptr;
    if (!World) return;

    UGSDCrowdManagerSubsystem* CrowdManager = World->GetSubsystem<UGSDCrowdManagerSubsystem>();
    if (!CrowdManager) return;

    CrowdManager->RemoveDensityModifier(ModifierTag);

    GSDEVENT_LOG(TEXT("SafeZoneModifier removed"));
}
```

**Key Design Decisions:**
- Fixed DensityMultiplier of 0.01 (1% spawn rate = effectively blocked)
- Intensity scales radius, not density (safe zone should always be effective)
- Follows exact pattern from DensityReduceModifier
</action>
  <verify>
    # Verify header exists
    grep -q "class GSD_DAILYEVENTS_API UGSDSafeZoneModifier" \
      Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDSafeZoneModifier.h

    # Verify near-zero multiplier
    grep -q "0.01f" \
      Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDSafeZoneModifier.h

    # Verify implementation
    grep -q "AddDensityModifier" \
      Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDSafeZoneModifier.cpp

    echo "SafeZoneModifier verified"
  </verify>
  <done>SafeZoneModifier compiles with 0.01 density multiplier creating near-zero spawn zones</done>
</task>

<task type="auto">
  <name>Task 3: Create Navigation Block Modifier</name>
  <files>
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDNavigationBlockModifier.h
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDNavigationBlockModifier.cpp
  </files>
  <action>
Create UGSDNavigationBlockModifier that prevents AI navigation in blocked areas.

**Research Note:** Zone Graph lane blocking API is unclear (Open Question in RESEARCH.md). Using NavModifierVolume as proven fallback approach.

**Header (GSDNavigationBlockModifier.h):**
```cpp
#pragma once

#include "CoreMinimal.h"
#include "DataAssets/GSDEventModifierConfig.h"
#include "Navigation/NavModifierVolume.h"
#include "GSDNavigationBlockModifier.generated.h"

/**
 * Concrete modifier that blocks AI navigation in an area.
 * Used by Construction event to close lanes.
 *
 * Uses NavModifierVolume to block NavMesh generation.
 * Falls back from ZoneGraph due to unclear runtime blocking API.
 */
UCLASS(BlueprintType, Category = "GSD|Events|Modifiers")
class GSD_DAILYEVENTS_API UGSDNavigationBlockModifier : public UGSDEventModifierConfig
{
    GENERATED_BODY()

public:
    UGSDNavigationBlockModifier();

    //-- Navigation Block Settings --
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Navigation")
    FVector VolumeExtent = FVector(500.0f, 500.0f, 200.0f);

    //-- UGSDEventModifierConfig Interface --
    virtual void ApplyModifier_Implementation(UObject* WorldContext, FVector Center, float IntensityMultiplier) override;
    virtual void RemoveModifier_Implementation(UObject* WorldContext) override;

protected:
    /** Track spawned volumes for cleanup */
    UPROPERTY()
    TArray<TObjectPtr<ANavModifierVolume>> SpawnedVolumes;
};
```

**Implementation (GSDNavigationBlockModifier.cpp):**
```cpp
#include "Modifiers/GSDNavigationBlockModifier.h"
#include "Navigation/NavModifierVolume.h"

UGSDNavigationBlockModifier::UGSDNavigationBlockModifier()
{
    ModifierTag = FGameplayTag::RequestGameplayTag(FName("Event.Modifier.NavigationBlock"));
}

void UGSDNavigationBlockModifier::ApplyModifier_Implementation(UObject* WorldContext, FVector Center, float IntensityMultiplier)
{
    if (!WorldContext) return;

    UWorld* World = WorldContext->GetWorld();
    if (!World) return;

    // Calculate effective extent based on intensity
    FVector EffectiveExtent = VolumeExtent * IntensityMultiplier;

    // Spawn NavModifierVolume to block navigation
    FActorSpawnParameters SpawnParams;
    SpawnParams.SpawnCollisionHandlingOverride = ESpawnActorCollisionHandlingMethod::AlwaysSpawn;

    ANavModifierVolume* NavVolume = World->SpawnActor<ANavModifierVolume>(Center, FRotator::ZeroRotator, SpawnParams);
    if (NavVolume)
    {
        NavVolume->SetActorScale3D(EffectiveExtent / FVector(100.0f)); // Default volume is 100 units
        SpawnedVolumes.Add(NavVolume);

        GSDEVENT_LOG(TEXT("NavigationBlockModifier applied: Center=%s Extent=%s"),
            *Center.ToString(), *EffectiveExtent.ToString());
    }
}

void UGSDNavigationBlockModifier::RemoveModifier_Implementation(UObject* WorldContext)
{
    // Destroy all spawned volumes
    for (ANavModifierVolume* Volume : SpawnedVolumes)
    {
        if (Volume)
        {
            Volume->Destroy();
        }
    }
    SpawnedVolumes.Empty();

    GSDEVENT_LOG(TEXT("NavigationBlockModifier removed: %d volumes destroyed"), SpawnedVolumes.Num());
}
```

**Key Design Decisions:**
- Uses NavModifierVolume (proven UE5 approach) instead of ZoneGraph (unclear API)
- Stores spawned volumes in TArray for cleanup (Pitfall 1 prevention)
- Intensity scales volume extent
- Always cleanup in RemoveModifier
</action>
  <verify>
    # Verify header exists
    grep -q "class GSD_DAILYEVENTS_API UGSDNavigationBlockModifier" \
      Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/Modifiers/GSDNavigationBlockModifier.h

    # Verify NavModifierVolume usage
    grep -q "ANavModifierVolume" \
      Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDNavigationBlockModifier.cpp

    # Verify cleanup pattern
    grep -q "SpawnedVolumes" \
      Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/Modifiers/GSDNavigationBlockModifier.cpp

    echo "NavigationBlockModifier verified"
  </verify>
  <done>NavigationBlockModifier compiles using NavModifierVolume with proper cleanup tracking</done>
</task>

</tasks>

<verification>
## Compilation Check
```bash
# Compile GSD_DailyEvents plugin
# UnrealBuildTool should succeed without errors
```

## Pattern Verification
- [ ] All three modifiers extend UGSDEventModifierConfig
- [ ] All three implement ApplyModifier_Implementation
- [ ] All three implement RemoveModifier_Implementation
- [ ] All three set appropriate ModifierTag
- [ ] NavigationBlockModifier tracks spawned volumes for cleanup
</verification>

<success_criteria>
- DensityReduceModifier decreases spawn rates (multiplier < 1.0)
- SafeZoneModifier creates near-zero spawn zones (multiplier = 0.01)
- NavigationBlockModifier blocks AI navigation using NavModifierVolume
- All modifiers follow Apply/Remove pattern from Phase 8
- All modifiers prevent state leaks with proper cleanup
</success_criteria>

<output>
After completion, create `.planning/phases/09-event-implementations/09-01-SUMMARY.md`
</output>
