---
phase: 12-production-enhancements
plan: 7
type: execute
wave: 3
depends_on: [12-06]
files_modified:
  - Plugins/GSD_Crowds/Source/GSD_Crowds/Public/Input/GSDCrowdInputConfig.h
  - Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Input/GSDCrowdInputConfig.cpp
  - Plugins/GSD_Crowds/Source/GSD_Crowds/GSD_Crowds.Build.cs
autonomous: true
must_haves:
  truths:
    - "EnhancedInput module integrated"
    - "Debug controls use input actions"
    - "Input is configurable via DataAsset"
  artifacts:
    - path: "Plugins/GSD_Crowds/Source/GSD_Crowds/Public/Input/GSDCrowdInputConfig.h"
      provides: "Input configuration"
      contains: "UInputAction|ToggleDebugWidget|IncreaseDensity"
---

<objective>
Add EnhancedInput module integration for debug controls.

Purpose: Council review (unreal-interface-rick) identified missing EnhancedInput module. This plan adds input configuration for debug controls.

Output: EnhancedInput module integrated, debug controls configurable via DataAsset.

Council Issues: unreal-interface-rick CRITICAL #1 - Missing EnhancedInput module
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-production-enhancements/12-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add EnhancedInput Module Dependency</name>
  <files>
    Plugins/GSD_Crowds/Source/GSD_Crowds/GSD_Crowds.Build.cs
  </files>
  <action>
Add EnhancedInput module to Build.cs.

**Changes:**
```cpp
PublicDependencyModuleNames.AddRange(new string[] {
    "Core",
    "CoreUObject",
    "Engine",
    "InputCore",
    "MassEntity",
    "MassCommon",
    "MassSpawner",
    "MassRepresentation",
    "MassMovement",
    "MassAI",

    // Input system
    "EnhancedInput",

    // UI
    "UMG",
    "Slate",
    "SlateCore"
});
```
  </action>
  <verify>
    ```bash
    grep -q "EnhancedInput" Plugins/GSD_Crowds/Source/GSD_Crowds/GSD_Crowds.Build.cs && echo "✓ EnhancedInput dependency added"
    ```
  </verify>
  <done>
    - EnhancedInput module dependency added
    - Build will link against module
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GSDCrowdInputConfig DataAsset</name>
  <files>
    Plugins/GSD_Crowds/Source/GSD_Crowds/Public/Input/GSDCrowdInputConfig.h
    Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Input/GSDCrowdInputConfig.cpp
  </files>
  <action>
Create input configuration DataAsset for crowd debug controls.

**GSDCrowdInputConfig.h:**
```cpp
#pragma once

#include "CoreMinimal.h"
#include "Engine/DataAsset.h"
#include "InputAction.h"
#include "GSDCrowdInputConfig.generated.h"

class UInputAction;
class UInputMappingContext;

/**
 * Input configuration for crowd debug controls.
 * Create Input Actions in editor and assign here.
 */
UCLASS(BlueprintType)
class GSD_CROWDS_API UGSDCrowdInputConfig : public UDataAsset
{
    GENERATED_BODY()

public:
    // Toggle debug dashboard visibility
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Debug")
    UInputAction* ToggleDebugWidgetAction = nullptr;

    // Increase crowd density
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Crowd")
    UInputAction* IncreaseDensityAction = nullptr;

    // Decrease crowd density
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Crowd")
    UInputAction* DecreaseDensityAction = nullptr;

    // Toggle crowd system enabled
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Crowd")
    UInputAction* ToggleCrowdEnabledAction = nullptr;

    // Reset crowd to default state
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Crowd")
    UInputAction* ResetCrowdAction = nullptr;

    // Spawn test crowd
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Debug")
    UInputAction* SpawnTestCrowdAction = nullptr;

    // Despawn all crowds
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Debug")
    UInputAction* DespawnAllCrowdsAction = nullptr;

    // Input mapping context for debug controls
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Input")
    UInputMappingContext* DebugMappingContext = nullptr;

    // Priority for mapping context
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Input")
    int32 MappingContextPriority = 100;

    // Get config name for logging
    FName GetConfigName() const { return ConfigName; }

protected:
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Config")
    FName ConfigName = FName("DefaultCrowdInput");
};
```

**GSDCrowdInputConfig.cpp:**
```cpp
#include "Input/GSDCrowdInputConfig.h"

// No implementation needed - DataAsset is configured in editor
```
  </action>
  <verify>
    ```bash
    [ -f "Plugins/GSD_Crowds/Source/GSD_Crowds/Public/Input/GSDCrowdInputConfig.h" ] && echo "✓ GSDCrowdInputConfig.h created"
    [ -f "Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Input/GSDCrowdInputConfig.cpp" ] && echo "✓ GSDCrowdInputConfig.cpp created"
    ```
  </verify>
  <done>
    - Input config DataAsset created
    - Debug input actions defined
    - Mapping context reference added
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Input Component Helper</name>
  <files>
    Plugins/GSD_Crowds/Source/GSD_Crowds/Public/Components/GSDCrowdInputComponent.h
    Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Components/GSDCrowdInputComponent.cpp
  </files>
  <action>
Create input component for binding debug controls.

**GSDCrowdInputComponent.h:**
```cpp
#pragma once

#include "CoreMinimal.h"
#include "Components/ActorComponent.h"
#include "EnhancedInputComponent.h"
#include "GSDCrowdInputComponent.generated.h"

class UGSDCrowdInputConfig;

DECLARE_DYNAMIC_MULTICAST_DELEGATE(FOnToggleDebugWidget);
DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FOnDensityChanged, float, Delta);
DECLARE_DYNAMIC_MULTICAST_DELEGATE(FOnToggleCrowdEnabled);
DECLARE_DYNAMIC_MULTICAST_DELEGATE(FOnResetCrowd);
DECLARE_DYNAMIC_MULTICAST_DELEGATE(FOnSpawnTestCrowd);
DECLARE_DYNAMIC_MULTICAST_DELEGATE(FOnDespawnAllCrowds);

/**
 * Component that handles crowd debug input binding.
 * Add to player controller for debug controls.
 */
UCLASS(ClassGroup=(Custom), meta=(BlueprintSpawnableComponent))
class GSD_CROWDS_API UGSDCrowdInputComponent : public UActorComponent
{
    GENERATED_BODY()

public:
    UGSDCrowdInputComponent();

    virtual void BeginPlay() override;
    virtual void EndPlay(const EEndPlayReason::Reason EndPlayReason) override;

    // Set input configuration
    UFUNCTION(BlueprintCallable, Category = "Input")
    void SetInputConfig(UGSDCrowdInputConfig* InConfig);

    // Enable/disable debug input
    UFUNCTION(BlueprintCallable, Category = "Input")
    void SetDebugEnabled(bool bEnabled);

    // Delegates for input events
    UPROPERTY(BlueprintAssignable, Category = "Crowd|Events")
    FOnToggleDebugWidget OnToggleDebugWidget;

    UPROPERTY(BlueprintAssignable, Category = "Crowd|Events")
    FOnDensityChanged OnDensityIncreased;

    UPROPERTY(BlueprintAssignable, Category = "Crowd|Events")
    FOnDensityChanged OnDensityDecreased;

    UPROPERTY(BlueprintAssignable, Category = "Crowd|Events")
    FOnToggleCrowdEnabled OnToggleCrowdEnabled;

    UPROPERTY(BlueprintAssignable, Category = "Crowd|Events")
    FOnResetCrowd OnResetCrowd;

    UPROPERTY(BlueprintAssignable, Category = "Crowd|Events")
    FOnSpawnTestCrowd OnSpawnTestCrowd;

    UPROPERTY(BlueprintAssignable, Category = "Crowd|Events")
    FOnDespawnAllCrowds OnDespawnAllCrowds;

protected:
    // Bind input actions
    void BindInputActions();
    void UnbindInputActions();

    // Input action handlers
    void HandleToggleDebugWidget(const FInputActionValue& Value);
    void HandleIncreaseDensity(const FInputActionValue& Value);
    void HandleDecreaseDensity(const FInputActionValue& Value);
    void HandleToggleCrowdEnabled(const FInputActionValue& Value);
    void HandleResetCrowd(const FInputActionValue& Value);
    void HandleSpawnTestCrowd(const FInputActionValue& Value);
    void HandleDespawnAllCrowds(const FInputActionValue& Value);

    // Configuration
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Config")
    UGSDCrowdInputConfig* InputConfig = nullptr;

    // State
    bool bDebugEnabled = true;
    TArray<FEnhancedInputActionEventBinding*> ActionBindings;
};
```

**Key Implementation:**
```cpp
void UGSDCrowdInputComponent::BindInputActions()
{
    if (!InputConfig || !bDebugEnabled)
    {
        return;
    }

    APlayerController* PC = Cast<APlayerController>(GetOwner());
    if (!PC)
    {
        return;
    }

    UEnhancedInputComponent* EIC = Cast<UEnhancedInputComponent>(PC->InputComponent);
    if (!EIC)
    {
        return;
    }

    // Add mapping context
    if (InputConfig->DebugMappingContext)
    {
        if (UEnhancedInputLocalPlayerSubsystem* Subsystem =
            ULocalPlayer::GetSubsystem<UEnhancedInputLocalPlayerSubsystem>(PC->GetLocalPlayer()))
        {
            Subsystem->AddMappingContext(InputConfig->DebugMappingContext,
                InputConfig->MappingContextPriority);
        }
    }

    // Bind actions
    if (InputConfig->ToggleDebugWidgetAction)
    {
        ActionBindings.Add(EIC->BindAction(
            InputConfig->ToggleDebugWidgetAction,
            ETriggerEvent::Triggered,
            this,
            &UGSDCrowdInputComponent::HandleToggleDebugWidget));
    }

    // ... bind other actions
}
```
  </action>
  <verify>
    ```bash
    [ -f "Plugins/GSD_Crowds/Source/GSD_Crowds/Public/Components/GSDCrowdInputComponent.h" ] && echo "✓ GSDCrowdInputComponent.h created"
    grep -q "UEnhancedInputComponent" Plugins/GSD_Crowds/Source/GSD_Crowds/Private/Components/GSDCrowdInputComponent.cpp && echo "✓ EnhancedInput binding implemented"
    ```
  </verify>
  <done>
    - Input component created
    - EnhancedInput binding implemented
    - Delegates for all debug actions
    - Mapping context support
  </done>
</task>

<task type="auto">
  <name>Task 4: Create Input Setup Documentation</name>
  <files>
    Plugins/GSD_Crowds/Docs/CrowdInputSetup.md
  </files>
  <action>
Create documentation for input setup.

**Content:**
```markdown
# Crowd Debug Input Setup

## Overview
The crowd system uses EnhancedInput for debug controls. This guide explains setup.

## Prerequisites
- Enable EnhancedInput plugin in project
- Create Input Actions in editor

## Setup Steps

### 1. Create Input Actions
In Content Browser:
1. Right-click → Input → Input Action
2. Create actions:
   - IA_ToggleDebugWidget
   - IA_IncreaseDensity
   - IA_DecreaseDensity
   - IA_ToggleCrowdEnabled
   - IA_ResetCrowd
   - IA_SpawnTestCrowd
   - IA_DespawnAllCrowds

### 2. Create Input Mapping Context
1. Right-click → Input → Input Mapping Context
2. Name: IMC_CrowdDebug
3. Add mappings:
   - F1 → ToggleDebugWidget
   - Plus → IncreaseDensity
   - Minus → DecreaseDensity
   - F2 → ToggleCrowdEnabled
   - F3 → ResetCrowd
   - F4 → SpawnTestCrowd
   - F5 → DespawnAllCrowds

### 3. Create Input Config DataAsset
1. Create DataAsset → GSDCrowdInputConfig
2. Assign Input Actions
3. Assign Mapping Context

### 4. Add Component to Player Controller
```cpp
// In player controller
UPROPERTY(VisibleAnywhere, BlueprintReadOnly)
UGSDCrowdInputComponent* CrowdInputComponent;

// In constructor
CrowdInputComponent = CreateDefaultSubobject<UGSDCrowdInputComponent>(TEXT("CrowdInput"));

// In BeginPlay
CrowdInputComponent->SetInputConfig(LoadedConfig);
```

## Default Key Bindings
| Action | Default Key |
|--------|-------------|
| Toggle Debug Widget | F1 |
| Increase Density | + |
| Decrease Density | - |
| Toggle Crowd Enabled | F2 |
| Reset Crowd | F3 |
| Spawn Test Crowd | F4 |
| Despawn All | F5 |
```
  </action>
  <verify>
    ```bash
    [ -f "Plugins/GSD_Crowds/Docs/CrowdInputSetup.md" ] && echo "✓ Input setup documentation created"
    ```
  </verify>
  <done>
    - Setup guide created
    - Key bindings documented
    - Component usage explained
  </done>
</task>

</tasks>

<verification>
1. EnhancedInput module dependency added
2. Input config DataAsset created
3. Input component with EnhancedInput binding
4. Debug actions configurable
5. Documentation created
</verification>

<success_criteria>
- EnhancedInput module integrated in Build.cs
- Input config DataAsset for debug controls
- Input component binds to EnhancedInput
- All debug actions configurable
- Key bindings documented
</success_criteria>

<output>
After completion, create `.planning/phases/12-production-enhancements/12-07-SUMMARY.md`
</output>
