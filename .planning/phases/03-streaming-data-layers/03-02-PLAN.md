---
phase: 03-streaming-data-layers
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/GSD_CityStreaming/Content/DataLayers/DL_BaseCity.uasset (editor-created)
  - Plugins/GSD_CityStreaming/Content/DataLayers/DL_Events.uasset (editor-created)
  - Plugins/GSD_CityStreaming/Content/DataLayers/DL_Construction.uasset (editor-created)
  - Plugins/GSD_CityStreaming/Content/DataLayers/DL_Parties.uasset (editor-created)
  - Plugins/GSD_CityStreaming/Content/Config/DA_GSDDataLayerConfig.uasset (editor-created)
  - Plugins/GSD_CityStreaming/Docs/DataLayerWorkflow.md
autonomous: false

council_review:
  date: 2026-02-25
  status: PASS
  addressed_issues:
    - "Added DA_GSDDataLayerConfig DataAsset instance"
    - "Added scalability settings documentation"
    - "Added performance best practices"

must_haves:
  truths:
    - "Multiple Data Layers exist for different content types"
    - "Each layer is marked as Runtime (not Editor-only)"
    - "Developer documentation explains layer assignment workflow"
    - "DataAsset config instance links layers to GSDDataLayerManager"
  artifacts:
    - path: "Plugins/GSD_CityStreaming/Docs/DataLayerWorkflow.md"
      provides: "Editor workflow documentation"
      min_lines: 80
    - path: "Plugins/GSD_CityStreaming/Content/Config/DA_GSDDataLayerConfig.uasset"
      provides: "DataAsset instance linking layers to manager"
      type: "editor-created"
  key_links:
    - from: "Level Actors"
      to: "Data Layer Assets"
      via: "Actor Details panel -> Data Layers section"
      pattern: "Data Layer assignment"
    - from: "DA_GSDDataLayerConfig"
      to: "GSDDataLayerManager"
      via: "SetLayerConfig() in Blueprint or C++"
      pattern: "Data-driven configuration"
---

<objective>
Create Data Layer assets and document the editor workflow for assigning actors to layers.

Purpose: Establish the layer organization structure that enables runtime content toggling for events. Four layers cover the main content categories.

Output: Four Data Layer assets (DL_BaseCity, DL_Events, DL_Construction, DL_Parties) and workflow documentation.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-streaming-data-layers/03-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-action">
  <name>Task 1: Create Data Layer Assets in Editor</name>
  <files>Plugins/GSD_CityStreaming/Content/DataLayers/</files>
  <action>
Create four Runtime Data Layer assets in the Unreal Editor.

Steps for each layer:
1. Open Unreal Editor
2. In Content Browser, navigate to Plugins/GSD_CityStreaming/Content/
3. Create folder "DataLayers" if not exists
4. Right-click -> Miscellaneous -> Data Layer
5. Name it according to convention below
6. In Details panel, set "Data Layer Type" to "Runtime" (NOT Editor)

Layers to create:
1. **DL_BaseCity** - Always-on base content (buildings, roads, terrain)
2. **DL_Events** - Dynamic event content (bonfires, rave zones)
3. **DL_Construction** - Construction barricades, road closures
4. **DL_Parties** - Block party props, crowd extras

CRITICAL: Each layer MUST have "Runtime" type selected. Editor-only layers cannot be toggled at runtime.
  </action>
  <verify>In Content Browser, verify 4 Data Layer assets exist in Plugins/GSD_CityStreaming/Content/DataLayers/</verify>
  <done>Four Runtime Data Layer assets created: DL_BaseCity, DL_Events, DL_Construction, DL_Parties</done>
</task>

<task type="checkpoint:human-action">
  <name>Task 2: Create DataAsset Config Instance</name>
  <files>Plugins/GSD_CityStreaming/Content/Config/DA_GSDDataLayerConfig.uasset</files>
  <action>
Create the DataAsset instance that links Data Layers to GSDDataLayerManager.

Steps:
1. In Content Browser, navigate to Plugins/GSD_CityStreaming/Content/
2. Create folder "Config" if not exists
3. Right-click -> Blueprints -> Data Asset
4. Select "GSDDataLayerConfig" as the class
5. Name it "DA_GSDDataLayerConfig"
6. Open and configure:
   - BaseCityLayer: DL_BaseCity
   - EventsLayer: DL_Events
   - ConstructionLayer: DL_Construction
   - PartiesLayer: DL_Parties
   - AllRuntimeLayers: Add all 4 layers
   - MaxActivationTimePerFrameMs: 5.0 (default)
   - StagedActivationDelay: 0.1 (default)
   - bUseStagedActivation: true

This DataAsset enables data-driven layer configuration - no hardcoded layer names in C++.
  </action>
  <verify>DA_GSDDataLayerConfig exists with all 4 layers assigned</verify>
  <done>DataAsset config instance created linking all Data Layers</done>
</task>

<task type="auto">
  <name>Task 3: Create Data Layer Workflow Documentation</name>
  <files>Plugins/GSD_CityStreaming/Docs/DataLayerWorkflow.md</files>
  <action>
Create markdown documentation explaining the Data Layer workflow for team members.

Document must include:

1. **Layer Overview**
   - Table of all layers with their purpose
   - Which layer to use for different content types

2. **Creating New Layers** (if needed)
   - Steps to create a new Runtime Data Layer
   - Naming convention: DL_[Category]
   - IMPORTANT: Must add new layers to DA_GSDDataLayerConfig

3. **Assigning Actors to Layers**
   - Select actor in viewport or outliner
   - In Details panel, find "Data Layers" section
   - Click + to add layer, select from dropdown
   - Actors can belong to multiple layers

4. **Testing Layer Toggling**
   - Use console command: `DataLayer.SetState [LayerName] [State]`
   - States: Unloaded, Loaded, Activated
   - Or use GSDDataLayerManager in Blueprint

5. **Performance Best Practices** (CRITICAL from Council review)
   - NEVER activate all layers at once - causes 200-500ms hitch
   - Use ActivateLayersStaged() for multiple layers
   - Default frame budget is 5ms per frame
   - Keep base content in DL_BaseCity (always loaded)
   - Event layers should be activated on-demand

6. **Console Commands Reference**
   - `DataLayer.List` - List all layers
   - `DataLayer.SetState [Name] [State]` - Toggle layer
   - `wp.Runtime.DrawDataLayers 1` - Visualize layer bounds
   - `stat streaming` - Show streaming statistics

7. **Scalability Settings** (from Council review)
   - Low-end platforms: Reduce MaxActivationTimePerFrameMs to 2.0
   - Mobile: Consider disabling telemetry broadcasts
   - High-end: Can increase MaxRecentEvents to 200

8. **DataAsset Configuration**
   - DA_GSDDataLayerConfig links layers to manager
   - Per-map or per-game-mode configs supported
   - Call GSDDataLayerManager->SetLayerConfig() to switch
</action>
  <verify>File exists at Plugins/GSD_CityStreaming/Docs/DataLayerWorkflow.md with all sections documented</verify>
  <done>Workflow documentation created with layer overview, assignment steps, testing commands, and best practices</done>
</task>

</tasks>

<verification>
1. Four Data Layer assets exist in Plugins/GSD_CityStreaming/Content/DataLayers/
2. All layers are Runtime type (not Editor)
3. DA_GSDDataLayerConfig exists with all layers assigned
4. Workflow documentation exists and covers all required sections
5. Documentation includes console commands for testing
6. Documentation includes performance best practices
</verification>

<success_criteria>
- [x] DL_BaseCity Data Layer asset created (Runtime)
- [x] DL_Events Data Layer asset created (Runtime)
- [x] DL_Construction Data Layer asset created (Runtime)
- [x] DL_Parties Data Layer asset created (Runtime)
- [x] DA_GSDDataLayerConfig DataAsset created and configured
- [x] Workflow documentation complete with performance guidelines
</success_criteria>

<output>
After completion, create `.planning/phases/03-streaming-data-layers/03-02-SUMMARY.md`
</output>
