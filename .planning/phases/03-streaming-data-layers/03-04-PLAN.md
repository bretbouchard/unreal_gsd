---
phase: 03-streaming-data-layers
plan: 04
type: execute
wave: 2
depends_on:
  - "03-01"
files_modified:
  - Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/Components/GSDStreamingSourceComponent.h
  - Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Private/Components/GSDStreamingSourceComponent.cpp
  - Plugins/GSD_CityStreaming/Docs/VehicleStreamingIntegration.md
autonomous: true

must_haves:
  truths:
    - "Vehicles can enable/disable streaming based on state"
    - "Fast vehicles get extended loading range for predictive loading"
    - "Parked vehicles disable streaming to save performance"
  artifacts:
    - path: "Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/Components/GSDStreamingSourceComponent.h"
      provides: "Enhanced streaming source with vehicle-specific features"
      min_lines: 70
    - path: "Plugins/GSD_CityStreaming/Docs/VehicleStreamingIntegration.md"
      provides: "Vehicle integration guide"
      min_lines: 60
  key_links:
    - from: "Vehicle Pawn"
      to: "GSDStreamingSourceComponent"
      via: "AddComponent in constructor, SetStreamingEnabled on state change"
      pattern: "SetStreamingEnabled|SetLoadingRangeMultiplier"
---

<objective>
Enhance GSDStreamingSourceComponent with vehicle-specific features and create integration documentation.

Purpose: Enables vehicles to use predictive streaming with state-based enable/disable. Fast vehicles get extended loading range; parked vehicles disable streaming to avoid performance overhead.

Output: Enhanced GSDStreamingSourceComponent with vehicle integration pattern documented.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-streaming-data-layers/03-RESEARCH.md

# Reference existing implementation
@Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/Components/GSDStreamingSourceComponent.h
@Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Private/Components/GSDStreamingSourceComponent.cpp
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance GSDStreamingSourceComponent Header</name>
  <files>Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/Components/GSDStreamingSourceComponent.h</files>
  <action>
Enhance the existing GSDStreamingSourceComponent with vehicle-specific accessors.

Current implementation already has:
- bStreamingEnabled (property + SetStreamingEnabled/IsStreamingEnabled)
- LoadingRangeMultiplier (property + SetLoadingRangeMultiplier)
- bPredictiveLoading (property)
- PredictiveLoadingVelocityThreshold (property)

Add new Blueprint-accessible getters for these properties:
- `float GetLoadingRangeMultiplier() const` - Returns current multiplier
- `bool IsPredictiveLoadingEnabled() const` - Returns bPredictiveLoading
- `float GetPredictiveLoadingThreshold() const` - Returns threshold

Add new utility function:
- `void ConfigureForVehicle(bool bIsFastVehicle, float VelocityThreshold = 1000.0f)` - Preset configuration for vehicles

The ConfigureForVehicle should:
- Enable predictive loading
- Set PredictiveLoadingVelocityThreshold
- If bIsFastVehicle, set LoadingRangeMultiplier to 2.0f
- If not fast, set LoadingRangeMultiplier to 1.0f

Add this to the header after the existing functions:
```cpp
// Vehicle configuration helper
UFUNCTION(BlueprintCallable, Category = "GSD|Streaming")
void ConfigureForVehicle(bool bIsFastVehicle, float VelocityThreshold = 1000.0f);

// Property getters
UFUNCTION(BlueprintPure, Category = "GSD|Streaming")
float GetLoadingRangeMultiplier() const { return LoadingRangeMultiplier; }

UFUNCTION(BlueprintPure, Category = "GSD|Streaming")
bool IsPredictiveLoadingEnabled() const { return bPredictiveLoading; }

UFUNCTION(BlueprintPure, Category = "GSD|Streaming")
float GetPredictiveLoadingThreshold() const { return PredictiveLoadingVelocityThreshold; }
```
  </action>
  <verify>Header updated with ConfigureForVehicle and three getter functions</verify>
  <done>GSDStreamingSourceComponent enhanced with vehicle configuration helper and property getters</done>
</task>

<task type="auto">
  <name>Task 2: Implement Vehicle Configuration</name>
  <files>Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Private/Components/GSDStreamingSourceComponent.cpp</files>
  <action>
Add the ConfigureForVehicle implementation to the existing cpp file.

Implementation:
```cpp
void UGSDStreamingSourceComponent::ConfigureForVehicle(bool bIsFastVehicle, float VelocityThreshold)
{
    bPredictiveLoading = true;
    PredictiveLoadingVelocityThreshold = VelocityThreshold;

    if (bIsFastVehicle)
    {
        LoadingRangeMultiplier = 2.0f;
        GSD_LOG(TEXT("GSDStreamingSourceComponent: Configured for fast vehicle (2.0x range)"));
    }
    else
    {
        LoadingRangeMultiplier = 1.0f;
        GSD_LOG(TEXT("GSDStreamingSourceComponent: Configured for standard vehicle"));
    }

    UpdateStreamingSourceState();
}
```

Also update the existing UpdateStreamingSourceState() to use the getters where appropriate (if not already doing so).

Keep existing functionality intact - only ADD new functionality.
  </action>
  <verify>Plugin compiles. ConfigureForVehicle sets properties correctly.</verify>
  <done>ConfigureForVehicle implemented and tested</done>
</task>

<task type="auto">
  <name>Task 3: Create Vehicle Streaming Integration Documentation</name>
  <files>Plugins/GSD_CityStreaming/Docs/VehicleStreamingIntegration.md</files>
  <action>
Create markdown documentation explaining how to integrate streaming with vehicles.

Document must include:

1. **Overview**
   - Why vehicles need streaming sources
   - Performance considerations (parked vs driving)

2. **Adding Component to Vehicle**
   - Add GSDStreamingSourceComponent in vehicle Blueprint or C++ constructor
   - Call ConfigureForVehicle() based on vehicle type

3. **State-Based Streaming Control**
   - Driving: SetStreamingEnabled(true)
   - Parked: SetStreamingEnabled(false)
   - Destroyed: SetStreamingEnabled(false)

4. **Fast Vehicle Configuration**
   - Call ConfigureForVehicle(true) for sports cars, etc.
   - LoadingRangeMultiplier = 2.0 for extended range
   - Predictive loading activates above velocity threshold

5. **Code Examples**
   ```cpp
   // C++ constructor
   StreamingSource = CreateDefaultSubobject<UGSDStreamingSourceComponent>(TEXT("StreamingSource"));
   StreamingSource->ConfigureForVehicle(bIsFastVehicle);

   // On state change
   void AVehicle::OnStateChanged(EVehicleState NewState)
   {
       if (StreamingSource)
       {
           StreamingSource->SetStreamingEnabled(NewState == EVehicleState::Driving);
       }
   }
   ```

6. **Performance Notes**
   - 100+ parked vehicles with streaming enabled = bad
   - Always disable for parked vehicles
   - Predictive loading only matters above threshold speed

7. **Blueprint Integration**
   - All functions are Blueprint-callable
   - Can configure entirely in vehicle Blueprint
</action>
  <verify>Documentation exists with all sections complete</verify>
  <done>Vehicle streaming integration guide created with code examples and best practices</done>
</task>

</tasks>

<verification>
1. Plugin compiles without errors
2. GSDStreamingSourceComponent has ConfigureForVehicle function
3. ConfigureForVehicle correctly sets predictive loading and range multiplier
4. Getter functions expose all relevant properties
5. Documentation covers all integration scenarios
</verification>

<success_criteria>
- [x] ConfigureForVehicle helper function implemented
- [x] Property getters (GetLoadingRangeMultiplier, IsPredictiveLoadingEnabled, GetPredictiveLoadingThreshold) added
- [x] Vehicle integration documentation complete
- [x] Existing functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/03-streaming-data-layers/03-04-SUMMARY.md`
</output>
