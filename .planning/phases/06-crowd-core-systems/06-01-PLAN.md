---
phase: 06-crowd-core-systems
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/GSD_Crowds/GSD_Crowds.uplugin
  - Plugins/GSD_Crowds/Source/GSD_Crowds/GSD_Crowds.Build.cs
  - Plugins/GSD_Crowds/Source/GSD_Crowds/Public/GSD_Crowds.h
  - Plugins/GSD_Crowds/Source/GSD_Crowds/Private/GSD_Crowds.cpp
  - Plugins/GSD_Crowds/Source/GSD_Crowds/Public/GSDCrowdLog.h
autonomous: true
must_haves:
  truths:
    - "GSD_Crowds plugin compiles and loads in Unreal Editor"
    - "Mass Entity module dependencies are properly configured"
    - "Plugin follows established GSD plugin structure pattern"
  artifacts:
    - path: "Plugins/GSD_Crowds/GSD_Crowds.uplugin"
      provides: "Plugin descriptor"
      contains: "Name=GSD_Crowds"
    - path: "Plugins/GSD_Crowds/Source/GSD_Crowds/GSD_Crowds.Build.cs"
      provides: "Build configuration"
      contains: "MassEntity"
    - path: "Plugins/GSD_Crowds/Source/GSD_Crowds/Public/GSD_Crowds.h"
      provides: "Module interface"
      min_lines: 20
  key_links:
    - from: "GSD_Crowds.Build.cs"
      to: "GSD_Core module"
      via: "PublicDependencyModuleNames"
      pattern: "GSD_Core"
---

<objective>
Create GSD_Crowds plugin foundation with Mass Entity module dependencies.

Purpose: Establish the GSD_Crowds plugin structure that will house all crowd simulation systems using UE5's Mass Entity framework. This follows the established GSD plugin pattern from GSD_Vehicles.

Output: Compilable GSD_Crowds plugin with proper module loading order and Mass Entity dependencies.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-crowd-core-systems/06-RESEARCH.md

# Reference patterns from GSD_Vehicles plugin
@Plugins/GSD_Vehicles/GSD_Vehicles.uplugin
@Plugins/GSD_Vehicles/Source/GSD_Vehicles/GSD_Vehicles.Build.cs
@Plugins/GSD_Vehicles/Source/GSD_Vehicles/Public/GSD_Vehicles.h
@Plugins/GSD_Vehicles/Source/GSD_Vehicles/Private/GSD_Vehicles.cpp
</context>

<tasks>

<task type="auto">
  <name>Create GSD_Crowds plugin structure</name>
  <files>
    Plugins/GSD_Crowds/GSD_Crowds.uplugin
    Plugins/GSD_Crowds/Source/GSD_Crowds/GSD_Crowds.Build.cs
    Plugins/GSD_Crowds/Source/GSD_Crowds/Public/GSD_Crowds.h
    Plugins/GSD_Crowds/Source/GSD_Crowds/Private/GSD_Crowds.cpp
    Plugins/GSD_Crowds/Source/GSD_Crowds/Public/GSDCrowdLog.h
    Plugins/GSD_Crowds/Resources/Icon128.png
  </files>
  <action>
    Create GSD_Crowds plugin following the GSD_Vehicles pattern:

    1. **Plugin Descriptor** (GSD_Crowds.uplugin):
       - Name: GSD_Crowds
       - Version: 1.0.0
       - FriendlyName: "GSD Crowds"
       - Description: "Crowd simulation using Mass Entity framework for 200+ entities"
       - Category: "GSD"
       - Modules: [{Name: "GSD_Crowds", Type: "Runtime", LoadingPhase: "PostEngineInit"}]
       - Plugins: [{Name: "GSD_Core"}, {Name: "GSD_CityStreaming"}]

    2. **Build.cs Configuration**:
       Public dependencies:
       - Core, CoreUObject, Engine
       - GSD_Core (interfaces, patterns)
       - GSD_CityStreaming (World Partition integration)
       - MassEntity (ECS framework)
       - MassRepresentation (LOD switching)
       - MassSpawner (entity spawning)
       - MassLOD (distance calculations)
       - MassCommon (shared types)

       Private dependencies:
       - MassAI (for future navigation support in Phase 7)

       Editor-only (if Target.bBuildEditor):
       - UnrealEd, AutomationController

    3. **Module Header** (GSD_Crowds.h):
       - Module class: FGSD_CrowdsModule
       - Inherits from: IModuleInterface
       - Standard StartupModule/ShutdownModule

    4. **Module Implementation** (GSD_Crowds.cpp):
       - Include GSDCrowdLog.h
       - StartupModule: LOG_GSDCROWDS initialization message
       - ShutdownModule: empty (cleanup happens automatically)

    5. **Logging Category** (GSDCrowdLog.h):
       - DECLARE_LOG_CATEGORY_EXTERN(LOG_GSDCROWDS, Log, All)
       - Pattern: LOG_GSDCROWDS, TEXT("Message")

    6. **Plugin Icon**:
       - Copy Icon128.png from GSD_Vehicles (placeholder, can customize later)

    **Why PostEngineInit loading phase:**
    - Mass Entity subsystems initialize during engine init
    - Must load AFTER GSD_Core (Phase 1 establishes this pattern)
    - Allows Mass Entity framework to be fully ready before plugin code runs

    **File structure:**
    ```
    Plugins/GSD_Crowds/
    ├── GSD_Crowds.uplugin
    ├── Resources/
    │   └── Icon128.png
    └── Source/
        └── GSD_Crowds/
            ├── GSD_Crowds.Build.cs
            ├── Public/
            │   ├── GSD_Crowds.h
            │   └── GSDCrowdLog.h
            └── Private/
                └── GSD_Crowds.cpp
    ```
  </action>
  <verify>
    # Compile the plugin
    # UnrealBuildTool should find no errors
    # Check that Mass Entity dependencies resolve correctly

    # In Unreal Editor:
    # 1. Plugins should show "GSD Crowds" in GSD category
    # 2. Plugin should be enabled by default
    # 3. No compilation errors in Output Log

    # Verify module load order:
    # GSD_Core -> GSD_CityStreaming -> GSD_Crowds
  </verify>
  <done>
    - GSD_Crowds plugin appears in Unreal Editor Plugins window
    - Plugin compiles without errors
    - Mass Entity modules properly linked
    - LOG_GSDCROWDS logging category functional
    - Plugin loads after GSD_Core and GSD_CityStreaming
  </done>
</task>

</tasks>

<verification>
1. Plugin compiles successfully
2. All Mass Entity dependencies resolve
3. Module loads in correct order (PostEngineInit after GSD_Core)
4. Logging category works (LOG_GSDCROWDS outputs to console)
</verification>

<success_criteria>
- GSD_Crowds plugin is visible and enabled in Unreal Editor
- No compilation warnings or errors
- Build.cs correctly references all required Mass Entity modules
- Plugin follows established GSD plugin patterns
</success_criteria>

<output>
After completion, create `.planning/phases/06-crowd-core-systems/06-01-SUMMARY.md`
</output>
