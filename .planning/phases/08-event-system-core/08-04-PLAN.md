---
phase: 08-event-system-core
plan: 04
type: execute
wave: 3
depends_on: ["08-02", "08-03"]
files_modified:
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDDailyEventConfig.h
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/DataAssets/GSDDailyEventConfig.cpp
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDEventModifierConfig.h
  - Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/DataAssets/GSDEventModifierConfig.cpp
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Event definitions are stored as Data Assets in the editor"
    - "Event configs extend UGSDDataAsset for migration support"
    - "Event modifiers have Apply/Remove pattern for runtime changes"
    - "Config validation catches errors before scheduling"
  artifacts:
    - path: "Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDDailyEventConfig.h"
      provides: "Base class for daily event definitions"
      contains: "UGSDDailyEventConfig"
      contains: "EventTag"
      contains: "DurationMinutes"
      min_lines: 60
    - path: "Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDEventModifierConfig.h"
      provides: "Base class for event modifiers"
      contains: "UGSDEventModifierConfig"
      contains: "ApplyModifier"
      contains: "RemoveModifier"
      min_lines: 50
  key_links:
    - from: "GSDDailyEventConfig"
      to: "UGSDDataAsset"
      via: "inheritance"
      pattern: ": public UGSDDataAsset"
    - from: "ApplyModifier"
      to: "CrowdManager/VehicleSpawner"
      via: "virtual function override"
      pattern: "AddDensityModifier|RemoveDensityModifier"
---

<objective>
Create event and modifier Data Asset base classes for editor-configurable event definitions.

Purpose: Enable designers to create events as Data Assets in the editor. Events extend UGSDDataAsset for migration support and validation. Modifiers use Apply/Remove pattern for runtime changes.

Output: UGSDDailyEventConfig and UGSDEventModifierConfig base classes ready for Phase 9 concrete implementations.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-event-system-core/08-RESEARCH.md

# Reference patterns
@Plugins/GSD_Core/Source/GSD_Core/Public/DataAssets/GSDDataAsset.h
@Plugins/GSD_Crowds/Source/GSD_Crowds/Public/DataAssets/GSDCrowdEntityConfig.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Daily Event Config Data Asset</name>
  <files>
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDDailyEventConfig.h
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/DataAssets/GSDDailyEventConfig.cpp
  </files>
  <action>
    Create the base class for daily event definitions, extending UGSDDataAsset.

    1. Create DataAssets/ directory under Public/ and Private/

    2. Create GSDDailyEventConfig.h:

    ```cpp
    #pragma once

    #include "CoreMinimal.h"
    #include "GameplayTagContainer.h"
    #include "GSDDataAsset.h"
    #include "GSDDailyEventConfig.generated.h"

    class UGSDEventModifierConfig;

    /**
     * Base class for daily event definitions.
     * Extend this for specific event types (Construction, Bonfire, etc.)
     *
     * Events are scheduled by GSDEventSchedulerSubsystem and executed
     * at their scheduled time with the configured parameters.
     */
    UCLASS(Abstract, BlueprintType, Category = "GSD|Events")
    class GSD_DAILYEVENTS_API UGSDDailyEventConfig : public UGSDDataAsset
    {
        GENERATED_BODY()

    public:
        //-- Event Identity --
        UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Event")
        FGameplayTag EventTag;

        UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Event")
        FText DisplayName;

        //-- Timing --
        UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Timing")
        float DurationMinutes = 60.0f;

        UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Timing")
        TArray<FName> ValidTimeSlots;  // "Morning", "Afternoon", "Evening"

        //-- Modifiers --
        UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Modifiers")
        TArray<TSoftObjectPtr<UGSDEventModifierConfig>> Modifiers;

        //-- Spawn Requirements --
        UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Spawning")
        TArray<FName> RequiredDataLayers;

        //-- Validation --
        virtual bool ValidateConfig(FString& OutError) const override;

        //-- Execution --
        /**
         * Called when event starts. Override in subclasses.
         * Apply modifiers, spawn actors, activate data layers.
         */
        UFUNCTION(BlueprintNativeEvent, Category = "Event")
        void OnEventStart(UObject* WorldContext, FVector Location, float Intensity);
        virtual void OnEventStart_Implementation(UObject* WorldContext, FVector Location, float Intensity);

        /**
         * Called when event ends. Override in subclasses.
         * Remove modifiers, despawn actors, deactivate data layers.
         */
        UFUNCTION(BlueprintNativeEvent, Category = "Event")
        void OnEventEnd(UObject* WorldContext);
        virtual void OnEventEnd_Implementation(UObject* WorldContext);
    };
    ```

    3. Create GSDDailyEventConfig.cpp with:
       - ValidateConfig: Check EventTag is valid, DurationMinutes > 0
       - OnEventStart_Implementation: Apply all modifiers
       - OnEventEnd_Implementation: Remove all modifiers
       - Include GSDEventLog.h for logging
  </action>
  <verify>
    grep -l "UGSDDailyEventConfig" Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDDailyEventConfig.h
    grep -l "UGSDDataAsset" Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDDailyEventConfig.h
    grep -l "OnEventStart" Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDDailyEventConfig.h
  </verify>
  <done>
    UGSDDailyEventConfig extends UGSDDataAsset. OnEventStart/OnEventEnd lifecycle methods exist.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Event Modifier Config Data Asset</name>
  <files>
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDEventModifierConfig.h
    Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Private/DataAssets/GSDEventModifierConfig.cpp
  </files>
  <action>
    Create the base class for event modifiers with Apply/Remove pattern.

    1. Create GSDEventModifierConfig.h:

    ```cpp
    #pragma once

    #include "CoreMinimal.h"
    #include "GameplayTagContainer.h"
    #include "GSDDataAsset.h"
    #include "GSDEventModifierConfig.generated.h"

    /**
     * Base class for event modifiers.
     * Modifiers are reusable effects that can be applied by events.
     *
     * Examples:
     * - DensityBoost: Increases spawn density in area
     * - NavigationBlock: Closes navigation lanes
     * - SafeZone: Disables hostile spawns in area
     *
     * CRITICAL: Always pair Apply with Remove to prevent state leaks.
     */
    UCLASS(Abstract, BlueprintType, Category = "GSD|Events")
    class GSD_DAILYEVENTS_API UGSDEventModifierConfig : public UGSDDataAsset
    {
        GENERATED_BODY()

    public:
        //-- Modifier Identity --
        UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Modifier")
        FGameplayTag ModifierTag;

        //-- Area of Effect --
        UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Modifier")
        float Radius = 1000.0f;

        UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Modifier")
        float Intensity = 1.0f;

        //-- Validation --
        virtual bool ValidateConfig(FString& OutError) const override;

        //-- Apply/Remove Pattern --

        /**
         * Apply this modifier to the target system.
         * Override in subclasses to affect CrowdManager, VehicleSpawner, etc.
         *
         * CRITICAL: Store state for removal. Must be reversible.
         */
        UFUNCTION(BlueprintNativeEvent, Category = "Modifier")
        void ApplyModifier(UObject* WorldContext, FVector Center, float IntensityMultiplier = 1.0f);
        virtual void ApplyModifier_Implementation(UObject* WorldContext, FVector Center, float IntensityMultiplier = 1.0f);

        /**
         * Remove this modifier from the target system.
         * CRITICAL: Must undo everything done in ApplyModifier.
         */
        UFUNCTION(BlueprintNativeEvent, Category = "Modifier")
        void RemoveModifier(UObject* WorldContext);
        virtual void RemoveModifier_Implementation(UObject* WorldContext);
    };
    ```

    2. Create GSDEventModifierConfig.cpp with:
       - ValidateConfig: Check ModifierTag is valid, Radius > 0
       - ApplyModifier_Implementation: Log warning "Base class ApplyModifier called"
       - RemoveModifier_Implementation: Log warning "Base class RemoveModifier called"
       - Include GSDEventLog.h for logging

    AVOID: Do not leave Apply without matching Remove. Do not modify global state without tracking.
  </action>
  <verify>
    grep -l "UGSDEventModifierConfig" Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDEventModifierConfig.h
    grep -l "ApplyModifier" Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDEventModifierConfig.h
    grep -l "RemoveModifier" Plugins/GSD_DailyEvents/Source/GSD_DailyEvents/Public/DataAssets/GSDEventModifierConfig.h
  </verify>
  <done>
    UGSDEventModifierConfig has Apply/Remove pattern. Validates config. Ready for Phase 9 implementations.
  </done>
</task>

</tasks>

<verification>
1. Both Data Assets compile without errors
2. ValidateConfig catches missing EventTag/ModifierTag
3. OnEventStart applies modifiers, OnEventEnd removes them
4. Apply/Remove pattern works correctly
</verification>

<success_criteria>
- UGSDDailyEventConfig extends UGSDDataAsset with ValidateConfig override
- UGSDEventModifierConfig provides Apply/Remove BlueprintNativeEvent methods
- Both classes are Abstract, forcing subclassing for concrete implementations
- Validation ensures EventTag/ModifierTag are set
</success_criteria>

<output>
After completion, create `.planning/phases/08-event-system-core/08-04-SUMMARY.md`
</output>
