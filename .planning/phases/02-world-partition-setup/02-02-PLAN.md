---
phase: 02-world-partition-setup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/GSD_CityStreaming/Content/HLOD/HLOD_Foliage.uasset
  - Plugins/GSD_CityStreaming/Content/HLOD/HLOD_Buildings.uasset
  - Plugins/GSD_CityStreaming/Content/HLOD/HLOD_Terrain.uasset
  - Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/Types/GSDHLODTypes.h
  - Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Private/Types/GSDHLODTypes.cpp
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Three HLOD layers exist: Foliage, Buildings, Terrain"
    - "HLOD layers have correct cell sizes and loading ranges"
    - "HLOD types define layer configuration for content categorization"
  artifacts:
    - path: "Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/Types/GSDHLODTypes.h"
      provides: "HLOD configuration types and enums"
      exports: ["FGSDHLODLayerConfig", "EGSDHLODLayerType"]
  key_links:
    - from: "GSDHLODTypes"
      to: "World Partition HLOD System"
      via: "HLOD Layer assets"
      pattern: "HLODLayer"
---

<objective>
Create three-tier HLOD (Hierarchical Level of Detail) system for efficient distant content rendering.

Purpose: Configure HLOD layers for different content types (foliage, buildings, terrain) to reduce draw calls and maintain performance when viewing distant city content.
Output: HLOD type definitions and configuration for 3-tier LOD system.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-world-partition-setup/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define HLOD Types and Configuration</name>
  <files>
    Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/Types/GSDHLODTypes.h
    Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Private/Types/GSDHLODTypes.cpp
  </files>
  <action>
    Create HLOD configuration types for the three-tier system:

    1. Create GSDHLODTypes.h with:

       // Enum for HLOD layer types
       UENUM(BlueprintType)
       enum class EGSDHLODLayerType : uint8
       {
           Instancing,      // For foliage - uses lowest LOD as imposters
           MergedMesh,      // For buildings - merges meshes, preserves detail
           SimplifiedMesh   // For terrain - aggressive simplification
       };

       // HLOD tier configuration
       USTRUCT(BlueprintType)
       struct FGSDHLODLayerConfig
       {
           GENERATED_BODY()

           // Layer identification
           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           FString LayerName;

           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           EGSDHLODLayerType LayerType = EGSDHLODLayerType::MergedMesh;

           // Grid settings
           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           int32 CellSize = 25600;

           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           int32 LoadingRange = 50000;

           // Merged mesh settings (for buildings)
           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           int32 TargetLightmapResolution = 256;

           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           bool bMergeMaterials = true;

           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           bool bGenerateNaniteMesh = true;

           // Simplified mesh settings (for terrain)
           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           float ScreenSize = 0.1f;

           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           float MergeDistance = 100.0f;
       };

       // Container for all HLOD tiers
       USTRUCT(BlueprintType)
       struct FGSDHLODSystemConfig
       {
           GENERATED_BODY()

           UPROPERTY(EditAnywhere, BlueprintReadWrite)
           TArray<FGSDHLODLayerConfig> Layers;
       };

    2. Create GSDHLODTypes.cpp with helper functions:
       - CreateDefaultCityHLODConfig() returning FGSDHLODSystemConfig with 3 pre-configured tiers

    3. Default tier configuration (from RESEARCH.md):
       - Tier 1 Foliage: Instancing, 51200 cell, 30000 range
       - Tier 2 Buildings: MergedMesh, 25600 cell, 50000 range, Nanite enabled
       - Tier 3 Terrain: SimplifiedMesh, 102400 cell, 100000 range

    Reference RESEARCH.md Pattern 2: Three-Tier HLOD System for exact values.
  </action>
  <verify>
    Verify HLOD types exist with correct structure:
    - grep -c "EGSDHLODLayerType" Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/Types/GSDHLODTypes.h
    - grep -c "FGSDHLODLayerConfig" Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/Types/GSDHLODTypes.h
    - grep -c "CreateDefaultCityHLODConfig" Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Private/Types/GSDHLODTypes.cpp
  </verify>
  <done>
    HLOD types define 3 layer types (Instancing, MergedMesh, SimplifiedMesh) with configuration structs for tier setup.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create HLOD Layer Configuration Data Asset</name>
  <files>
    Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/DataAssets/GSDHLODConfigAsset.h
    Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Private/DataAssets/GSDHLODConfigAsset.cpp
  </files>
  <action>
    Create a Data Asset class for HLOD configuration that can be referenced by levels:

    1. Create GSDHLODConfigAsset.h:
       - Inherit from UPrimaryDataAsset (follows Phase 1 pattern)
       - Include FGSDHLODSystemConfig as the main configuration
       - Add GetHLODConfig() static method
       - Add FName GetAssetPath() for easy referencing

    2. Create GSDHLODConfigAsset.cpp:
       - Implement GetHLODConfig() to load default config
       - Default asset path: "/GSD_CityStreaming/HLOD/DefaultCityHLODConfig"

    3. The Data Asset pattern allows:
       - Per-level HLOD configuration overrides
       - Designer-friendly editing in Editor
       - Consistent with GSD_DataAsset pattern from Phase 1

    Follow the UGSDDataAsset pattern established in Phase 1 Plan 05.
  </action>
  <verify>
    Verify HLOD config asset class exists:
    - grep -c "UGSDHLODConfigAsset" Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/DataAssets/GSDHLODConfigAsset.h
    - grep -c "UPrimaryDataAsset" Plugins/GSD_CityStreaming/Source/GSD_CityStreaming/Public/DataAssets/GSDHLODConfigAsset.h
  </verify>
  <done>
    HLOD configuration Data Asset class exists with default city HLOD config reference.
  </done>
</task>

<task type="auto">
  <name>Task 3: Document HLOD Generation Workflow</name>
  <files>
    Plugins/GSD_CityStreaming/Docs/HLODGeneration.md
  </files>
  <action>
    Create documentation file for HLOD generation workflow:

    1. Create Docs/HLODGeneration.md with:

       # HLOD Generation for Charlotte City

       ## Overview
       Three-tier HLOD system for efficient distant content rendering.

       ## Tier Configuration
       - **Tier 1 - Foliage (Instancing):** 512m cells, 300m range
       - **Tier 2 - Buildings (Merged Mesh):** 256m cells, 500m range, Nanite enabled
       - **Tier 3 - Terrain (Simplified Mesh):** 1km cells, 1km range

       ## Generation Methods

       ### In-Editor (Small Areas)
       Build > Build HLODs

       ### Commandlet (Large Cities)
       UnrealEditor.exe Project /Game/Maps/Charlotte_City -run=WorldPartitionBuilderCommandlet -AllowCommandletRendering -Builder=WorldPartitionHLODsBuilder

       ## Verification
       - Console: wp.Runtime.ToggleDrawRuntimeHash2D
       - HLOD actors appear green when loaded

       ## Performance Targets
       - Generation time: 10-40 minutes for full city
       - Draw call reduction: 70-90% for distant content

    This documentation follows the pattern from RESEARCH.md and provides guidance for future developers.
  </action>
  <verify>
    Verify documentation exists with HLOD generation instructions:
    - grep -c "WorldPartitionHLODsBuilder" Plugins/GSD_CityStreaming/Docs/HLODGeneration.md
    - grep -c "Tier" Plugins/GSD_CityStreaming/Docs/HLODGeneration.md
  </verify>
  <done>
    HLOD generation documentation exists with tier configuration and commandlet instructions.
  </done>
</task>

</tasks>

<verification>
1. EGSDHLODLayerType enum defines 3 layer types
2. FGSDHLODLayerConfig struct contains all tier settings
3. FGSDHLODSystemConfig provides container for multiple layers
4. CreateDefaultCityHLODConfig() returns 3 pre-configured tiers
5. UGSDHLODConfigAsset Data Asset class exists
6. HLOD generation documentation exists
</verification>

<success_criteria>
- HLOD types define Instancing, MergedMesh, and SimplifiedMesh layer types
- Default configuration provides 3-tier setup for foliage, buildings, terrain
- HLOD config Data Asset follows GSD_DataAsset pattern from Phase 1
- Documentation covers in-editor and commandlet generation methods
</success_criteria>

<output>
After completion, create `.planning/phases/02-world-partition-setup/02-02-SUMMARY.md`
</output>
