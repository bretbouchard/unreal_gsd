---
phase: 04-vehicle-core-systems
plan: 04
type: execute
wave: 3
depends_on: ["04-03"]
files_modified:
  - Plugins/GSD_Vehicles/Source/GSD_Vehicles/Public/Validation/GSDVehicleValidationLibrary.h
  - Plugins/GSD_Vehicles/Source/GSD_Vehicles/Private/Validation/GSDVehicleValidationLibrary.cpp
autonomous: true

must_haves:
  truths:
    - "ValidateWheelBoneOrientation function exists and checks bone orientation"
    - "Validation checks X-axis is forward and Z-axis is up"
    - "Error messages clearly indicate which bone failed and why"
  artifacts:
    - path: "Plugins/GSD_Vehicles/Source/GSD_Vehicles/Public/Validation/GSDVehicleValidationLibrary.h"
      provides: "Blueprint function library for vehicle validation"
      contains: "ValidateWheelBoneOrientation"
      min_lines: 30
    - path: "Plugins/GSD_Vehicles/Source/GSD_Vehicles/Private/Validation/GSDVehicleValidationLibrary.cpp"
      provides: "Validation implementation"
      contains: "ValidateWheelBoneOrientation"
      min_lines: 80
  key_links:
    - from: "GSDVehicleValidationLibrary"
      to: "USkeletalMesh"
      via: "ValidateWheelBoneOrientation parameter"
      pattern: "USkeletalMesh.*SkeletalMesh"
---

<objective>
Create a validation utility for checking wheel bone orientation in skeletal meshes to prevent physics bugs.

Purpose: Prevent common vehicle setup bugs by validating wheel bone orientation at edit time (X=Forward, Y=Left, Z=Up).
Output: Blueprint-accessible validation library for wheel bone checks.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-vehicle-core-systems/04-RESEARCH.md

# Reference the wheel bone validation code from research
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GSDVehicleValidationLibrary Header</name>
  <files>
    Plugins/GSD_Vehicles/Source/GSD_Vehicles/Public/Validation/GSDVehicleValidationLibrary.h
  </files>
  <action>
Create validation function library header for wheel bone validation.

Based on research (04-RESEARCH.md Pitfall 1 and code examples), implement:

1. Create Validation directory structure if needed:
   mkdir -p Plugins/GSD_Vehicles/Source/GSD_Vehicles/Public/Validation
   mkdir -p Plugins/GSD_Vehicles/Source/GSD_Vehicles/Private/Validation

2. Create GSDVehicleValidationLibrary.h:

   Include headers:
   - CoreMinimal.h
   - Kismet/BlueprintFunctionLibrary.h
   - GSDVehicleValidationLibrary.generated.h

   Class declaration:
   - UCLASS()
   - class GSD_VEHICLES_API UGSDVehicleValidationLibrary : public UBlueprintFunctionLibrary

   Functions (all UFUNCTION(BlueprintCallable, Category = "GSD|Vehicles|Validation")):

   ValidateWheelBoneOrientation:
   - Parameters: USkeletalMesh* SkeletalMesh, FName BoneName, FString& OutError
   - Returns: bool (true if valid)
   - Validates a single wheel bone's orientation

   ValidateAllWheelBones:
   - Parameters: USkeletalMesh* SkeletalMesh, const TArray&lt;FName&gt;& WheelBoneNames, TArray&lt;FString&gt;& OutErrors
   - Returns: bool (true if all valid)
   - Validates all wheel bones in a skeletal mesh

Documentation comment should explain:
- UE5 expects wheel bones with X=Forward, Y=Left, Z=Up
- Incorrect orientation causes physics bugs (wheels rotating sideways, erratic handling)
- Call this during asset import or validation passes
</action>
  <verify>
grep "class.*GSDVehicleValidationLibrary.*UBlueprintFunctionLibrary" Plugins/GSD_Vehicles/Source/GSD_Vehicles/Public/Validation/GSDVehicleValidationLibrary.h
grep "ValidateWheelBoneOrientation" Plugins/GSD_Vehicles/Source/GSD_Vehicles/Public/Validation/GSDVehicleValidationLibrary.h
grep "ValidateAllWheelBones" Plugins/GSD_Vehicles/Source/GSD_Vehicles/Public/Validation/GSDVehicleValidationLibrary.h
</verify>
  <done>
GSDVehicleValidationLibrary header with single and batch wheel bone validation functions.
</done>
</task>

<task type="auto">
  <name>Task 2: Create GSDVehicleValidationLibrary Implementation</name>
  <files>
    Plugins/GSD_Vehicles/Source/GSD_Vehicles/Private/Validation/GSDVehicleValidationLibrary.cpp
  </files>
  <action>
Create validation implementation that checks wheel bone orientation.

Based on research (04-RESEARCH.md code example), implement:

1. Create GSDVehicleValidationLibrary.cpp with includes:
   - Validation/GSDVehicleValidationLibrary.h
   - Engine/SkeletalMesh.h
   - Rendering/SkeletalMeshModel.h
   - GSDVehicleLog.h

2. Implement ValidateWheelBoneOrientation:
   - Check SkeletalMesh is not null (return false with error if null)
   - Get FReferenceSkeleton from SkeletalMesh->GetRefSkeleton()
   - Find bone index using RefSkeleton.FindBoneIndex(BoneName)
   - Check bone exists (return false with error if not found)
   - Get bone transform: RefSkeleton.GetRefBonePose()[BoneIndex]
   - Get bone rotation: BoneTransform.GetRotation()
   - Get forward axis (X): BoneRotation.GetAxisX()
   - Get up axis (Z): BoneRotation.GetAxisZ()
   - Validate forward axis: X component should be close to 1.0 or -1.0 (tolerance 0.1)
   - Validate up axis: Z component should be close to 1.0 or -1.0 (tolerance 0.1)
   - If forward invalid: format error message with bone name and actual axis values
   - If up invalid: format error message with bone name and actual axis values
   - Return true if both valid

3. Implement ValidateAllWheelBones:
   - Clear OutErrors array
   - For each bone name in WheelBoneNames:
     - Call ValidateWheelBoneOrientation
     - If validation fails, add error to OutErrors
   - Return true if OutErrors is empty

Error message format (from research):
"Bone '{BoneName}': X-axis ({X}, {Y}, {Z}) should point forward (1, 0, 0) or (-1, 0, 0)"
"Bone '{BoneName}': Z-axis ({X}, {Y}, {Z}) should point up (0, 0, 1) or (0, 0, -1)"

Log validation failures using LOG_GSDVEHICLES for debugging.
</action>
  <verify>
grep "ValidateWheelBoneOrientation" Plugins/GSD_Vehicles/Source/GSD_Vehicles/Private/Validation/GSDVehicleValidationLibrary.cpp
grep "GetAxisX" Plugins/GSD_Vehicles/Source/GSD_Vehicles/Private/Validation/GSDVehicleValidationLibrary.cpp
grep "GetAxisZ" Plugins/GSD_Vehicles/Source/GSD_Vehicles/Private/Validation/GSDVehicleValidationLibrary.cpp
grep "should point forward" Plugins/GSD_Vehicles/Source/GSD_Vehicles/Private/Validation/GSDVehicleValidationLibrary.cpp
</verify>
  <done>
GSDVehicleValidationLibrary implementation checking wheel bone X=Forward, Z=Up orientation.
</done>
</task>

</tasks>

<verification>
1. ValidateWheelBoneOrientation checks X-axis is forward
2. ValidateWheelBoneOrientation checks Z-axis is up
3. Error messages include bone name and actual axis values
4. ValidateAllWheelBones validates multiple bones
5. Functions are Blueprint-callable
</verification>

<success_criteria>
- Validation library checks wheel bone orientation
- X-axis must point forward (1,0,0) or (-1,0,0)
- Z-axis must point up (0,0,1) or (0,0,-1)
- Clear error messages for invalid orientations
- Blueprint-accessible for editor integration
</success_criteria>

<output>
After completion, create `.planning/phases/04-vehicle-core-systems/04-04-SUMMARY.md`
</output>
